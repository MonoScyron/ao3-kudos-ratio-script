// ==UserScript==
// @name                AO3 Comments Dropdown (WIP)
// @namespace           https://github.com/MonoScyron/ao3-scripts
// @version             0.0.1
// @description         Dropdown button for random nice commments.
// @author              MonoScyron
// @updateURL           https://raw.githubusercontent.com/MonoScyron/ao3-scripts/main/dist/ao3-comments-dropdown.js
// @downloadURL         https://raw.githubusercontent.com/MonoScyron/ao3-scripts/main/dist/ao3-comments-dropdown.js
// @match               https://archiveofourown.org/works/*
// @match               https://archiveofourown.org/chapters/*
// @icon                https://archiveofourown.org/images/ao3_logos/logo_42.png
// @resource cJSON      https://raw.githubusercontent.com/MonoScyron/ao3-scripts/main/json/comments.json
// @grant               GM_getResourceText
// @noframes
// ==/UserScript==
(()=>{var t={451:t=>{var e=function(){var t=function(t,s,i){this.errors=[],void 0===i.raw&&(this.errors.push("Empty input for node"),i.raw=""),t instanceof e.Grammar?(this.grammar=t,this.parent=null,this.depth=0,this.childIndex=0):(this.grammar=t.grammar,this.parent=t,this.depth=t.depth+1,this.childIndex=s),this.raw=i.raw,this.type=i.type,this.isExpanded=!1,this.grammar||this.errors.push("No grammar specified for this node "+this)};function s(t,e){this.node=t;var s=e.split(":");this.target=s[0],1===s.length?this.type=2:(this.rule=s[1],"POP"===this.rule?this.type=1:this.type=0)}function i(t,e){this.raw=e,this.grammar=t,this.falloff=1,Array.isArray(e)?this.defaultRules=e:("string"==typeof e||e instanceof String)&&(this.defaultRules=[e])}t.prototype.toString=function(){return"Node('"+this.raw+"' "+this.type+" d:"+this.depth+")"},t.prototype.expandChildren=function(s,i){if(this.children=[],this.finishedText="",this.childRule=s,void 0!==this.childRule){var r=e.parse(s);r.errors.length>0&&(this.errors=this.errors.concat(r.errors));for(var n=0;n<r.length;n++)this.children[n]=new t(this,n,r[n]),i||this.children[n].expand(i),this.finishedText+=this.children[n].finishedText}else this.errors.push("No child rule provided, can't expand children")},t.prototype.expand=function(t){if(!this.isExpanded)switch(this.isExpanded=!0,this.expansionErrors=[],this.type){case-1:this.expandChildren(this.raw,t);break;case 0:this.finishedText=this.raw;break;case 1:this.preactions=[],this.postactions=[];var i=e.parseTag(this.raw);this.symbol=i.symbol,this.modifiers=i.modifiers;for(var r=0;r<i.preactions.length;r++)this.preactions[r]=new s(this,i.preactions[r].raw);for(r=0;r<i.postactions.length;r++);for(r=0;r<this.preactions.length;r++)0===this.preactions[r].type&&this.postactions.push(this.preactions[r].createUndo());for(r=0;r<this.preactions.length;r++)this.preactions[r].activate();this.finishedText=this.raw;var n=this.grammar.selectRule(this.symbol,this,this.errors);for(this.expandChildren(n,t),r=0;r<this.modifiers.length;r++){var a=this.modifiers[r],h=[];if(a.indexOf("(")>0){var o=/\(([^)]+)\)/.exec(this.modifiers[r]);!o||o.length<2||(h=o[1].split(","),a=this.modifiers[r].substring(0,a.indexOf("(")))}var l=this.grammar.modifiers[a];l?this.finishedText=l(this.finishedText,h):(this.errors.push("Missing modifier "+a),this.finishedText+="((."+a+"))")}for(r=0;r<this.postactions.length;r++)this.postactions[r].activate();break;case 2:this.action=new s(this,this.raw),this.action.activate(),this.finishedText=""}},t.prototype.clearEscapeChars=function(){this.finishedText=this.finishedText.replace(/\\\\/g,"DOUBLEBACKSLASH").replace(/\\/g,"").replace(/DOUBLEBACKSLASH/g,"\\")},s.prototype.createUndo=function(){return 0===this.type?new s(this.node,this.target+":POP"):null},s.prototype.activate=function(){var e=this.node.grammar;switch(this.type){case 0:this.ruleSections=this.rule.split(","),this.finishedRules=[],this.ruleNodes=[];for(var s=0;s<this.ruleSections.length;s++){var i=new t(e,0,{type:-1,raw:this.ruleSections[s]});i.expand(),this.finishedRules.push(i.finishedText)}e.pushRules(this.target,this.finishedRules,this);break;case 1:e.popRules(this.target);break;case 2:e.flatten(this.target,!0)}},s.prototype.toText=function(){switch(this.type){case 0:return this.target+":"+this.rule;case 1:return this.target+":POP";case 2:return"((some function))";default:return"((Unknown Action))"}},i.prototype.selectRule=function(t){if(this.conditionalRule){var e=this.grammar.expand(this.conditionalRule,!0);if(this.conditionalValues[e]&&null!=(i=this.conditionalValues[e].selectRule(t)))return i}if(this.ranking)for(var s=0;s<this.ranking.length;s++){var i;if(null!=(i=this.ranking.selectRule()))return i}if(void 0!==this.defaultRules){var r=0,n=this.distribution;switch(n||(n=this.grammar.distribution),n){case"shuffle":this.shuffledDeck&&0!==this.shuffledDeck.length||(this.shuffledDeck=function(t,e){for(var s,i,r=t.length;0!==r;)i=Math.floor(Math.random()*r),s=t[r-=1],t[r]=t[i],t[i]=s;return t}(Array.apply(null,{length:this.defaultRules.length}).map(Number.call,Number),this.falloff)),r=this.shuffledDeck.pop();break;case"weighted":t.push("Weighted distribution not yet implemented");break;case"falloff":t.push("Falloff distribution not yet implemented");break;default:r=Math.floor(Math.pow(Math.random(),this.falloff)*this.defaultRules.length)}return this.defaultUses||(this.defaultUses=[]),this.defaultUses[r]=++this.defaultUses[r]||1,this.defaultRules[r]}return t.push("No default rules defined for "+this),null},i.prototype.clearState=function(){this.defaultUses&&(this.defaultUses=[])};var r=function(t,e,s){this.key=e,this.grammar=t,this.rawRules=s,this.baseRules=new i(this.grammar,s),this.clearState()};r.prototype.clearState=function(){this.stack=[this.baseRules],this.uses=[],this.baseRules.clearState()},r.prototype.pushRules=function(t){var e=new i(this.grammar,t);this.stack.push(e)},r.prototype.popRules=function(){this.stack.pop()},r.prototype.selectRule=function(t,e){return this.uses.push({node:t}),0===this.stack.length?(e.push("The rule stack for '"+this.key+"' is empty, too many pops?"),"(("+this.key+"))"):this.stack[this.stack.length-1].selectRule()},r.prototype.getActiveRules=function(){return 0===this.stack.length?null:this.stack[this.stack.length-1].selectRule()},r.prototype.rulesToJSON=function(){return JSON.stringify(this.rawRules)};var n=function(t,e){this.modifiers={},this.loadFromRawObj(t)};function a(t){var e=t.toLowerCase();return"a"===e||"e"===e||"i"===e||"o"===e||"u"===e}n.prototype.clearState=function(){for(var t=Object.keys(this.symbols),e=0;e<t.length;e++)this.symbols[t[e]].clearState()},n.prototype.addModifiers=function(t){for(var e in t)t.hasOwnProperty(e)&&(this.modifiers[e]=t[e])},n.prototype.loadFromRawObj=function(t){if(this.raw=t,this.symbols={},this.subgrammars=[],this.raw)for(var e in this.raw)this.raw.hasOwnProperty(e)&&(this.symbols[e]=new r(this,e,this.raw[e]))},n.prototype.createRoot=function(e){return new t(this,0,{type:-1,raw:e})},n.prototype.expand=function(t,e){var s=this.createRoot(t);return s.expand(),e||s.clearEscapeChars(),s},n.prototype.flatten=function(t,e){return this.expand(t,e).finishedText},n.prototype.toJSON=function(){for(var t=Object.keys(this.symbols),e=[],s=0;s<t.length;s++){var i=t[s];e.push(' "'+i+'" : '+this.symbols[i].rulesToJSON())}return"{\n"+e.join(",\n")+"\n}"},n.prototype.pushRules=function(t,e,s){void 0===this.symbols[t]?(this.symbols[t]=new r(this,t,e),s&&(this.symbols[t].isDynamic=!0)):this.symbols[t].pushRules(e)},n.prototype.popRules=function(t){this.symbols[t]||this.errors.push("Can't pop: no symbol for key "+t),this.symbols[t].popRules()},n.prototype.selectRule=function(t,e,s){if(this.symbols[t])return this.symbols[t].selectRule(e,s);for(var i=0;i<this.subgrammars.length;i++)if(this.subgrammars[i].symbols[t])return this.subgrammars[i].symbols[t].selectRule();return s.push("No symbol for '"+t+"'"),"(("+t+"))"};var h={replace:function(t,e){return t.replace(new RegExp(e[0].replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),e[1])},capitalizeAll:function(t){for(var e,s="",i=!0,r=0;r<t.length;r++)(e=t.charAt(r))>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"?i?(s+=t.charAt(r).toUpperCase(),i=!1):s+=t.charAt(r):(i=!0,s+=t.charAt(r));return s},capitalize:function(t){return t.charAt(0).toUpperCase()+t.substring(1)},a:function(t){if(t.length>0){if("u"===t.charAt(0).toLowerCase()&&t.length>2&&"i"===t.charAt(2).toLowerCase())return"a "+t;if(a(t.charAt(0)))return"an "+t}return"a "+t},firstS:function(t){console.log(t);var e=t.split(" "),s=h.s(e[0])+" "+e.slice(1).join(" ");return console.log(s),s},s:function(t){switch(t.charAt(t.length-1)){case"s":case"h":case"x":return t+"es";case"y":return a(t.charAt(t.length-2))?t+"s":t.substring(0,t.length-1)+"ies";default:return t+"s"}},ed:function(t){switch(t.charAt(t.length-1)){case"s":case"h":case"x":default:return t+"ed";case"e":return t+"d";case"y":return a(t.charAt(t.length-2))?t+"d":t.substring(0,t.length-1)+"ied"}}};return(e={createGrammar:function(t){return new n(t)},parseTag:function(t){for(var s={symbol:void 0,preactions:[],postactions:[],modifiers:[]},i=e.parse(t),r=void 0,n=0;n<i.length;n++)if(0===i[n].type){if(void 0!==r)throw"multiple main sections in "+t;r=i[n].raw}else s.preactions.push(i[n]);if(void 0===r);else{var a=r.split(".");s.symbol=a[0],s.modifiers=a.slice(1)}return s},parse:function(t){var e=0,s=!1,i=[],r=!1,n=[],a=0,h="",o=void 0;if(null===t)return(i=[]).errors=n,i;function l(e,s,r){var a;s-e<1&&(1===r&&n.push(e+": empty tag"),2===r&&n.push(e+": empty action")),a=void 0!==o?h+"\\"+t.substring(o+1,s):t.substring(e,s),i.push({type:r,raw:a}),o=void 0,h=""}for(var u=0;u<t.length;u++)if(r)r=!1;else switch(t.charAt(u)){case"[":0!==e||s||(a<u&&l(a,u,0),a=u+1),e++;break;case"]":0!=--e||s||(l(a,u,2),a=u+1);break;case"#":0===e&&(s?(l(a,u,1),a=u+1):(a<u&&l(a,u,0),a=u+1),s=!s);break;case"\\":r=!0,h+=t.substring(a,u),a=u+1,o=u}return a<t.length&&l(a,t.length,0),s&&n.push("Unclosed tag"),e>0&&n.push("Too many ["),e<0&&n.push("Too many ]"),(i=i.filter((function(t){return 0!==t.type||0!==t.raw.length}))).errors=n,i}}).baseEngModifiers=h,e.TraceryNode=t,e.Grammar=n,e.Symbol=r,e.RuleSet=i,e}();t.exports=e}},e={};function s(i){var r=e[i];if(void 0!==r)return r.exports;var n=e[i]={exports:{}};return t[i](n,n.exports,s),n.exports}(()=>{"use strict";!function(){let t=s(451),e=t.createGrammar(JSON.parse(GM_getResourceText("cJSON")));e.addModifiers(t.baseEngModifiers),console.log(e.flatten("ao3ex: #origin#"))}()})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0JBRVpHLEVBQVEsR0FDUk4sRUFBT0csS0FBSyxjQUVaRyxFQUFRLEdBQ1JOLEVBQU9HLEtBQUssZUFLaEJRLEVBQVdBLEVBQVN1SSxRQUFPLFNBQVNDLEdBQ2hDLE9BQXFCLElBQWpCQSxFQUFRNUksTUFBcUMsSUFBdkI0SSxFQUFRakosSUFBSVksTUFHMUMsS0FDU2QsT0FBU0EsRUFDWFcsQ0FDWCxJQXlISTBHLGlCQUFtQkEsRUFFM0IzSCxFQUFRQyxZQUFjQSxFQUV0QkQsRUFBUVUsUUFBVUEsRUFDbEJWLEVBQVE0RixPQUFTQSxFQUNqQjVGLEVBQVFzQixRQUFVQSxFQUNYdEIsQ0FDWCxDQXQxQmMsR0F3MUJkMEosRUFBT0MsUUFBVTNKLEMsR0MzMUJiNEosRUFBMkIsQ0FBQyxFQUdoQyxTQUFTQyxFQUFvQkMsR0FFNUIsSUFBSUMsRUFBZUgsRUFBeUJFLEdBQzVDLFFBQXFCdkosSUFBakJ3SixFQUNILE9BQU9BLEVBQWFKLFFBR3JCLElBQUlELEVBQVNFLEVBQXlCRSxHQUFZLENBR2pESCxRQUFTLENBQUMsR0FPWCxPQUhBSyxFQUFvQkYsR0FBVUosRUFBUUEsRUFBT0MsUUFBU0UsR0FHL0NILEVBQU9DLE9BQ2YsQyxvQkNyQkEsV0FFSSxJQUFJM0osRUFBVSxFQUFRLEtBQ2xCVyxFQUFVWCxFQUFRNEksY0FBY3ZDLEtBQUtsRSxNQUFNOEgsbUJBQW1CLFdBQ2xFdEosRUFBUW9HLGFBQWEvRyxFQUFRMkgsa0JBQzdCWSxRQUFRQyxJQUFJN0gsRUFBUXVELFFBQVEsbUJBQy9CLENBTkQsRSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy90cmFjZXJ5LWdyYW1tYXIvdHJhY2VyeS5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FvMy1jb21tZW50cy1kcm9wZG93bi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBhdXRob3IgS2F0ZVxuICovXG5cbnZhciB0cmFjZXJ5ID0gZnVuY3Rpb24oKSB7XG5cbiAgICB2YXIgVHJhY2VyeU5vZGUgPSBmdW5jdGlvbihwYXJlbnQsIGNoaWxkSW5kZXgsIHNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMuZXJyb3JzID0gW107XG5cbiAgICAgICAgLy8gTm8gaW5wdXQ/IEFkZCBhbiBlcnJvciwgYnV0IGNvbnRpbnVlIGFueXdheXNcbiAgICAgICAgaWYgKHNldHRpbmdzLnJhdyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKFwiRW1wdHkgaW5wdXQgZm9yIG5vZGVcIik7XG4gICAgICAgICAgICBzZXR0aW5ncy5yYXcgPSBcIlwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgdGhlIHJvb3Qgbm9kZSBvZiBhbiBleHBhbnNpb24sIGl0IHdpbGwgaGF2ZSB0aGUgZ3JhbW1hciBwYXNzZWQgYXMgdGhlICdwYXJlbnQnXG4gICAgICAgIC8vICBzZXQgdGhlIGdyYW1tYXIgZnJvbSB0aGUgJ3BhcmVudCcsIGFuZCBzZXQgYWxsIG90aGVyIHZhbHVlcyBmb3IgYSByb290IG5vZGVcbiAgICAgICAgaWYgKCBwYXJlbnQgaW5zdGFuY2VvZiB0cmFjZXJ5LkdyYW1tYXIpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JhbW1hciA9IHBhcmVudDtcbiAgICAgICAgICAgIHRoaXMucGFyZW50ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuZGVwdGggPSAwO1xuICAgICAgICAgICAgdGhpcy5jaGlsZEluZGV4ID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZ3JhbW1hciA9IHBhcmVudC5ncmFtbWFyO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgICAgICAgICB0aGlzLmRlcHRoID0gcGFyZW50LmRlcHRoICsgMTtcbiAgICAgICAgICAgIHRoaXMuY2hpbGRJbmRleCA9IGNoaWxkSW5kZXg7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJhdyA9IHNldHRpbmdzLnJhdztcbiAgICAgICAgdGhpcy50eXBlID0gc2V0dGluZ3MudHlwZTtcbiAgICAgICAgdGhpcy5pc0V4cGFuZGVkID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKCF0aGlzLmdyYW1tYXIpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goXCJObyBncmFtbWFyIHNwZWNpZmllZCBmb3IgdGhpcyBub2RlIFwiICsgdGhpcyk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBUcmFjZXJ5Tm9kZS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIFwiTm9kZSgnXCIgKyB0aGlzLnJhdyArIFwiJyBcIiArIHRoaXMudHlwZSArIFwiIGQ6XCIgKyB0aGlzLmRlcHRoICsgXCIpXCI7XG4gICAgfTtcblxuICAgIC8vIEV4cGFuZCB0aGUgbm9kZSAod2l0aCB0aGUgZ2l2ZW4gY2hpbGQgcnVsZSlcbiAgICAvLyAgTWFrZSBjaGlsZHJlbiBpZiB0aGUgbm9kZSBoYXMgYW55XG4gICAgVHJhY2VyeU5vZGUucHJvdG90eXBlLmV4cGFuZENoaWxkcmVuID0gZnVuY3Rpb24oY2hpbGRSdWxlLCBwcmV2ZW50UmVjdXJzaW9uKSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgdGhpcy5maW5pc2hlZFRleHQgPSBcIlwiO1xuXG4gICAgICAgIC8vIFNldCB0aGUgcnVsZSBmb3IgbWFraW5nIGNoaWxkcmVuLFxuICAgICAgICAvLyBhbmQgZXhwYW5kIGl0IGludG8gc2VjdGlvblxuICAgICAgICB0aGlzLmNoaWxkUnVsZSA9IGNoaWxkUnVsZTtcbiAgICAgICAgaWYgKHRoaXMuY2hpbGRSdWxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhciBzZWN0aW9ucyA9IHRyYWNlcnkucGFyc2UoY2hpbGRSdWxlKTtcblxuICAgICAgICAgICAgLy8gQWRkIGVycm9ycyB0byB0aGlzXG4gICAgICAgICAgICBpZiAoc2VjdGlvbnMuZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9ycyA9IHRoaXMuZXJyb3JzLmNvbmNhdChzZWN0aW9ucy5lcnJvcnMpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuW2ldID0gbmV3IFRyYWNlcnlOb2RlKHRoaXMsIGksIHNlY3Rpb25zW2ldKTtcbiAgICAgICAgICAgICAgICBpZiAoIXByZXZlbnRSZWN1cnNpb24pXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW5baV0uZXhwYW5kKHByZXZlbnRSZWN1cnNpb24pO1xuXG4gICAgICAgICAgICAgICAgLy8gQWRkIGluIHRoZSBmaW5pc2hlZCB0ZXh0XG4gICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZFRleHQgKz0gdGhpcy5jaGlsZHJlbltpXS5maW5pc2hlZFRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBJbiBub3JtYWwgb3BlcmF0aW9uLCB0aGlzIHNob3VsZG4ndCBldmVyIGhhcHBlblxuICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChcIk5vIGNoaWxkIHJ1bGUgcHJvdmlkZWQsIGNhbid0IGV4cGFuZCBjaGlsZHJlblwiKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBFeHBhbmQgdGhpcyBydWxlIChwb3NzaWJseSBjcmVhdGluZyBjaGlsZHJlbilcbiAgICBUcmFjZXJ5Tm9kZS5wcm90b3R5cGUuZXhwYW5kID0gZnVuY3Rpb24ocHJldmVudFJlY3Vyc2lvbikge1xuXG4gICAgICAgIGlmICghdGhpcy5pc0V4cGFuZGVkKSB7XG4gICAgICAgICAgICB0aGlzLmlzRXhwYW5kZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICB0aGlzLmV4cGFuc2lvbkVycm9ycyA9IFtdO1xuXG4gICAgICAgICAgICAvLyBUeXBlcyBvZiBub2Rlc1xuICAgICAgICAgICAgLy8gLTE6IHJhdywgbmVlZHMgcGFyc2luZ1xuICAgICAgICAgICAgLy8gIDA6IFBsYWludGV4dFxuICAgICAgICAgICAgLy8gIDE6IFRhZyAoXCIjc3ltYm9sLm1vZC5tb2QyLm1vZDMjXCIgb3IgXCIjW3B1c2hUYXJnZXQ6cHVzaFJ1bGVdc3ltYm9sLm1vZFwiKVxuICAgICAgICAgICAgLy8gIDI6IEFjdGlvbiAoXCJbcHVzaFRhcmdldDpwdXNoUnVsZV0sIFtwdXNoVGFyZ2V0OlBPUF1cIiwgbW9yZSBpbiB0aGUgZnV0dXJlKVxuXG4gICAgICAgICAgICBzd2l0Y2godGhpcy50eXBlKSB7XG4gICAgICAgICAgICAvLyBSYXcgcnVsZVxuICAgICAgICAgICAgY2FzZSAtMTpcblxuICAgICAgICAgICAgICAgIHRoaXMuZXhwYW5kQ2hpbGRyZW4odGhpcy5yYXcsIHByZXZlbnRSZWN1cnNpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAvLyBwbGFpbnRleHQsIGRvIG5vdGhpbmcgYnV0IGNvcHkgdGV4dCBpbnRvIGZpbnNpaGVkIHRleHRcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmlzaGVkVGV4dCA9IHRoaXMucmF3O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAvLyBUYWdcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAvLyBQYXJzZSB0byBmaW5kIGFueSBhY3Rpb25zLCBhbmQgZmlndXJlIG91dCB3aGF0IHRoZSBzeW1ib2wgaXNcbiAgICAgICAgICAgICAgICB0aGlzLnByZWFjdGlvbnMgPSBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLnBvc3RhY3Rpb25zID0gW107XG5cbiAgICAgICAgICAgICAgICB2YXIgcGFyc2VkID0gdHJhY2VyeS5wYXJzZVRhZyh0aGlzLnJhdyk7XG5cbiAgICAgICAgICAgICAgICAvLyBCcmVhayBpbnRvIHN5bWJvbCBhY3Rpb25zIGFuZCBtb2RpZmllcnNcbiAgICAgICAgICAgICAgICB0aGlzLnN5bWJvbCA9IHBhcnNlZC5zeW1ib2w7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RpZmllcnMgPSBwYXJzZWQubW9kaWZpZXJzO1xuXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGFsbCB0aGUgcHJlYWN0aW9ucyBmcm9tIHRoZSByYXcgc3ludGF4XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJzZWQucHJlYWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZWFjdGlvbnNbaV0gPSBuZXcgTm9kZUFjdGlvbih0aGlzLCBwYXJzZWQucHJlYWN0aW9uc1tpXS5yYXcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcnNlZC5wb3N0YWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAvLyAgIHRoaXMucG9zdGFjdGlvbnNbaV0gPSBuZXcgTm9kZUFjdGlvbih0aGlzLCBwYXJzZWQucG9zdGFjdGlvbnNbaV0ucmF3KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBNYWtlIHVuZG8gYWN0aW9ucyBmb3IgYWxsIHByZWFjdGlvbnMgKHBvcHMgZm9yIGVhY2ggcHVzaClcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucHJlYWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmVhY3Rpb25zW2ldLnR5cGUgPT09IDApXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc3RhY3Rpb25zLnB1c2godGhpcy5wcmVhY3Rpb25zW2ldLmNyZWF0ZVVuZG8oKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQWN0aXZhdGUgYWxsIHRoZSBwcmVhY3Rpb25zXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnByZWFjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmVhY3Rpb25zW2ldLmFjdGl2YXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZFRleHQgPSB0aGlzLnJhdztcblxuICAgICAgICAgICAgICAgIC8vIEV4cGFuZCAocGFzc2luZyB0aGUgbm9kZSwgdGhpcyBhbGxvd3MgdHJhY2tpbmcgb2YgcmVjdXJzaW9uIGRlcHRoKVxuXG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkUnVsZSA9IHRoaXMuZ3JhbW1hci5zZWxlY3RSdWxlKHRoaXMuc3ltYm9sLCB0aGlzLCB0aGlzLmVycm9ycyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmV4cGFuZENoaWxkcmVuKHNlbGVjdGVkUnVsZSwgcHJldmVudFJlY3Vyc2lvbik7XG5cbiAgICAgICAgICAgICAgICAvLyBBcHBseSBtb2RpZmllcnNcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBVcGRhdGUgcGFyc2UgZnVuY3Rpb24gdG8gbm90IHRyaWdnZXIgb24gaGFzaHRhZ3Mgd2l0aGluIHBhcmVudGhlc2lzIHdpdGhpbiB0YWdzLFxuICAgICAgICAgICAgICAgIC8vICAgc28gdGhhdCBtb2RpZmllciBwYXJhbWV0ZXJzIGNhbiBjb250YWluIHRhZ3MgXCIjc3RvcnkucmVwbGFjZSgjcHJvdGFnb25pc3QjLCAjbmV3Q2hhcmFjdGVyIykjXCJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubW9kaWZpZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtb2ROYW1lID0gdGhpcy5tb2RpZmllcnNbaV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBtb2RQYXJhbXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZE5hbWUuaW5kZXhPZihcIihcIikgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVnRXhwID0gL1xcKChbXildKylcXCkvO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUb2RvOiBpZ25vcmUgYW55IGVzY2FwZWQgY29tbWFzLiAgRm9yIG5vdywgY29tbWFzIGFsd2F5cyBzcGxpdFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSByZWdFeHAuZXhlYyh0aGlzLm1vZGlmaWVyc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdHMgfHwgcmVzdWx0cy5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb2RQYXJhbXMgPSByZXN1bHRzWzFdLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2ROYW1lID0gdGhpcy5tb2RpZmllcnNbaV0uc3Vic3RyaW5nKDAsIG1vZE5hbWUuaW5kZXhPZihcIihcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgbW9kID0gdGhpcy5ncmFtbWFyLm1vZGlmaWVyc1ttb2ROYW1lXTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBNaXNzaW5nIG1vZGlmaWVyP1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW1vZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChcIk1pc3NpbmcgbW9kaWZpZXIgXCIgKyBtb2ROYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWRUZXh0ICs9IFwiKCguXCIgKyBtb2ROYW1lICsgXCIpKVwiO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZFRleHQgPSBtb2QodGhpcy5maW5pc2hlZFRleHQsIG1vZFBhcmFtcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUGVyZm9ybSBwb3N0LWFjdGlvbnNcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucG9zdGFjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3N0YWN0aW9uc1tpXS5hY3RpdmF0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcblxuICAgICAgICAgICAgICAgIC8vIEp1c3QgYSBiYXJlIGFjdGlvbj8gIEV4cGFuZCBpdCFcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbiA9IG5ldyBOb2RlQWN0aW9uKHRoaXMsIHRoaXMucmF3KTtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbi5hY3RpdmF0ZSgpO1xuXG4gICAgICAgICAgICAgICAgLy8gTm8gdmlzaWJsZSB0ZXh0IGZvciBhbiBhY3Rpb25cbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBzb21lIHZpc2libGUgdGV4dCBmb3IgaWYgdGhlcmUgaXMgYSBmYWlsdXJlIHRvIHBlcmZvcm0gdGhlIGFjdGlvbj9cbiAgICAgICAgICAgICAgICB0aGlzLmZpbmlzaGVkVGV4dCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy9jb25zb2xlLndhcm4oXCJBbHJlYWR5IGV4cGFuZGVkIFwiICsgdGhpcyk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBUcmFjZXJ5Tm9kZS5wcm90b3R5cGUuY2xlYXJFc2NhcGVDaGFycyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHRoaXMuZmluaXNoZWRUZXh0ID0gdGhpcy5maW5pc2hlZFRleHQucmVwbGFjZSgvXFxcXFxcXFwvZywgXCJET1VCTEVCQUNLU0xBU0hcIikucmVwbGFjZSgvXFxcXC9nLCBcIlwiKS5yZXBsYWNlKC9ET1VCTEVCQUNLU0xBU0gvZywgXCJcXFxcXCIpO1xuICAgIH07XG5cbiAgICAvLyBBbiBhY3Rpb24gdGhhdCBvY2N1cnMgd2hlbiBhIG5vZGUgaXMgZXhwYW5kZWRcbiAgICAvLyBUeXBlcyBvZiBhY3Rpb25zOlxuICAgIC8vIDAgUHVzaDogW2tleTpydWxlXVxuICAgIC8vIDEgUG9wOiBba2V5OlBPUF1cbiAgICAvLyAyIGZ1bmN0aW9uOiBbZnVuY3Rpb25OYW1lKHBhcmFtMCxwYXJhbTEpXSAoVE9ETyEpXG4gICAgZnVuY3Rpb24gTm9kZUFjdGlvbihub2RlLCByYXcpIHtcbiAgICAgICAgLypcbiAgICAgICAgIGlmICghbm9kZSlcbiAgICAgICAgIGNvbnNvbGUud2FybihcIk5vIG5vZGUgZm9yIE5vZGVBY3Rpb25cIik7XG4gICAgICAgICBpZiAoIXJhdylcbiAgICAgICAgIGNvbnNvbGUud2FybihcIk5vIHJhdyBjb21tYW5kcyBmb3IgTm9kZUFjdGlvblwiKTtcbiAgICAgICAgICovXG5cbiAgICAgICAgdGhpcy5ub2RlID0gbm9kZTtcblxuICAgICAgICB2YXIgc2VjdGlvbnMgPSByYXcuc3BsaXQoXCI6XCIpO1xuICAgICAgICB0aGlzLnRhcmdldCA9IHNlY3Rpb25zWzBdO1xuXG4gICAgICAgIC8vIE5vIGNvbG9uPyBBIGZ1bmN0aW9uIVxuICAgICAgICBpZiAoc2VjdGlvbnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSAyO1xuXG4gICAgICAgIH1cblxuICAgICAgICAvLyBDb2xvbj8gSXQncyBlaXRoZXIgYSBwdXNoIG9yIGEgcG9wXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ydWxlID0gc2VjdGlvbnNbMV07XG4gICAgICAgICAgICBpZiAodGhpcy5ydWxlID09PSBcIlBPUFwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50eXBlID0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy50eXBlID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgTm9kZUFjdGlvbi5wcm90b3R5cGUuY3JlYXRlVW5kbyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy50eXBlID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5vZGVBY3Rpb24odGhpcy5ub2RlLCB0aGlzLnRhcmdldCArIFwiOlBPUFwiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUT0RPIE5vdCBzdXJlIGhvdyB0byBtYWtlIFVuZG8gYWN0aW9ucyBmb3IgZnVuY3Rpb25zIG9yIFBPUHNcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcblxuICAgIE5vZGVBY3Rpb24ucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBncmFtbWFyID0gdGhpcy5ub2RlLmdyYW1tYXI7XG4gICAgICAgIHN3aXRjaCh0aGlzLnR5cGUpIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgLy8gc3BsaXQgaW50byBzZWN0aW9ucyAodGhlIHdheSB0byBkZW5vdGUgYW4gYXJyYXkgb2YgcnVsZXMpXG4gICAgICAgICAgICB0aGlzLnJ1bGVTZWN0aW9ucyA9IHRoaXMucnVsZS5zcGxpdChcIixcIik7XG4gICAgICAgICAgICB0aGlzLmZpbmlzaGVkUnVsZXMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMucnVsZU5vZGVzID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucnVsZVNlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIG4gPSBuZXcgVHJhY2VyeU5vZGUoZ3JhbW1hciwgMCwge1xuICAgICAgICAgICAgICAgICAgICB0eXBlIDogLTEsXG4gICAgICAgICAgICAgICAgICAgIHJhdyA6IHRoaXMucnVsZVNlY3Rpb25zW2ldXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBuLmV4cGFuZCgpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZFJ1bGVzLnB1c2gobi5maW5pc2hlZFRleHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUT0RPOiBlc2NhcGUgY29tbWFzIHByb3Blcmx5XG4gICAgICAgICAgICBncmFtbWFyLnB1c2hSdWxlcyh0aGlzLnRhcmdldCwgdGhpcy5maW5pc2hlZFJ1bGVzLCB0aGlzKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICBncmFtbWFyLnBvcFJ1bGVzKHRoaXMudGFyZ2V0KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICBncmFtbWFyLmZsYXR0ZW4odGhpcy50YXJnZXQsIHRydWUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBOb2RlQWN0aW9uLnByb3RvdHlwZS50b1RleHQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgc3dpdGNoKHRoaXMudHlwZSkge1xuICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50YXJnZXQgKyBcIjpcIiArIHRoaXMucnVsZTtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFyZ2V0ICsgXCI6UE9QXCI7XG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgIHJldHVybiBcIigoc29tZSBmdW5jdGlvbikpXCI7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gXCIoKFVua25vd24gQWN0aW9uKSlcIjtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBTZXRzIG9mIHJ1bGVzXG4gICAgLy8gQ2FuIGFsc28gY29udGFpbiBjb25kaXRpb25hbCBvciBmYWxsYmFjayBzZXRzIG9mIHJ1bGVzZXRzKVxuICAgIGZ1bmN0aW9uIFJ1bGVTZXQoZ3JhbW1hciwgcmF3KSB7XG4gICAgICAgIHRoaXMucmF3ID0gcmF3O1xuICAgICAgICB0aGlzLmdyYW1tYXIgPSBncmFtbWFyO1xuICAgICAgICB0aGlzLmZhbGxvZmYgPSAxO1xuXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJhdykpIHtcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFJ1bGVzID0gcmF3O1xuICAgICAgICB9IGVsc2UgaWYgKCB0eXBlb2YgcmF3ID09PSAnc3RyaW5nJyB8fCByYXcgaW5zdGFuY2VvZiBTdHJpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFJ1bGVzID0gW3Jhd107XG4gICAgICAgIH0gZWxzZSBpZiAocmF3ID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgLy8gVE9ETzogc3VwcG9ydCBmb3IgY29uZGl0aW9uYWwgYW5kIGhpZXJhcmNoaWNhbCBydWxlIHNldHNcbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFJ1bGVTZXQucHJvdG90eXBlLnNlbGVjdFJ1bGUgPSBmdW5jdGlvbihlcnJvcnMpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJHZXQgcnVsZVwiLCB0aGlzLnJhdyk7XG4gICAgICAgIC8vIElzIHRoZXJlIGEgY29uZGl0aW9uYWw/XG4gICAgICAgIGlmICh0aGlzLmNvbmRpdGlvbmFsUnVsZSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5ncmFtbWFyLmV4cGFuZCh0aGlzLmNvbmRpdGlvbmFsUnVsZSwgdHJ1ZSk7XG4gICAgICAgICAgICAvLyBkb2VzIHRoaXMgdmFsdWUgbWF0Y2ggYW55IG9mIHRoZSBjb25kaXRpb25hbHM/XG4gICAgICAgICAgICBpZiAodGhpcy5jb25kaXRpb25hbFZhbHVlc1t2YWx1ZV0pIHtcbiAgICAgICAgICAgICAgICB2YXIgdiA9IHRoaXMuY29uZGl0aW9uYWxWYWx1ZXNbdmFsdWVdLnNlbGVjdFJ1bGUoZXJyb3JzKTtcbiAgICAgICAgICAgICAgICBpZiAodiAhPT0gbnVsbCAmJiB2ICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gTm8gcmV0dXJuZWQgdmFsdWU/XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJcyB0aGVyZSBhIHJhbmtlZCBvcmRlcj9cbiAgICAgICAgaWYgKHRoaXMucmFua2luZykge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJhbmtpbmcubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgdiA9IHRoaXMucmFua2luZy5zZWxlY3RSdWxlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHYgIT09IG51bGwgJiYgdiAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU3RpbGwgbm8gcmV0dXJuZWQgdmFsdWU/XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5kZWZhdWx0UnVsZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgICAgICAgIC8vIFNlbGVjdCBmcm9tIHRoaXMgYmFzaWMgYXJyYXkgb2YgcnVsZXNcblxuICAgICAgICAgICAgLy8gR2V0IHRoZSBkaXN0cmlidXRpb24gZnJvbSB0aGUgZ3JhbW1hciBpZiB0aGVyZSBpcyBubyBvdGhlclxuICAgICAgICAgICAgdmFyIGRpc3RyaWJ1dGlvbiA9IHRoaXMuZGlzdHJpYnV0aW9uO1xuICAgICAgICAgICAgaWYgKCFkaXN0cmlidXRpb24pXG4gICAgICAgICAgICAgICAgZGlzdHJpYnV0aW9uID0gdGhpcy5ncmFtbWFyLmRpc3RyaWJ1dGlvbjtcblxuICAgICAgICAgICAgc3dpdGNoKGRpc3RyaWJ1dGlvbikge1xuICAgICAgICAgICAgY2FzZSBcInNodWZmbGVcIjpcblxuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIHNodWZmbGUgZGVza1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5zaHVmZmxlZERlY2sgfHwgdGhpcy5zaHVmZmxlZERlY2subGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2UgYW4gYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaHVmZmxlZERlY2sgPSBmeXNodWZmbGUoQXJyYXkuYXBwbHkobnVsbCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoIDogdGhpcy5kZWZhdWx0UnVsZXMubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgIH0pLm1hcChOdW1iZXIuY2FsbCwgTnVtYmVyKSwgdGhpcy5mYWxsb2ZmKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGluZGV4ID0gdGhpcy5zaHVmZmxlZERlY2sucG9wKCk7XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ3ZWlnaHRlZFwiOlxuICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKFwiV2VpZ2h0ZWQgZGlzdHJpYnV0aW9uIG5vdCB5ZXQgaW1wbGVtZW50ZWRcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZmFsbG9mZlwiOlxuICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKFwiRmFsbG9mZiBkaXN0cmlidXRpb24gbm90IHlldCBpbXBsZW1lbnRlZFwiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG5cbiAgICAgICAgICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoTWF0aC5wb3coTWF0aC5yYW5kb20oKSwgdGhpcy5mYWxsb2ZmKSAqIHRoaXMuZGVmYXVsdFJ1bGVzLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5kZWZhdWx0VXNlcylcbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRVc2VzID0gW107XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRVc2VzW2luZGV4XSA9ICsrdGhpcy5kZWZhdWx0VXNlc1tpbmRleF0gfHwgMTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRSdWxlc1tpbmRleF07XG4gICAgICAgIH1cblxuICAgICAgICBlcnJvcnMucHVzaChcIk5vIGRlZmF1bHQgcnVsZXMgZGVmaW5lZCBmb3IgXCIgKyB0aGlzKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICB9O1xuXG4gICAgUnVsZVNldC5wcm90b3R5cGUuY2xlYXJTdGF0ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGlmICh0aGlzLmRlZmF1bHRVc2VzKSB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRVc2VzID0gW107XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZnlzaHVmZmxlKGFycmF5LCBmYWxsb2ZmKSB7XG4gICAgICAgIHZhciBjdXJyZW50SW5kZXggPSBhcnJheS5sZW5ndGgsXG4gICAgICAgICAgICB0ZW1wb3JhcnlWYWx1ZSxcbiAgICAgICAgICAgIHJhbmRvbUluZGV4O1xuXG4gICAgICAgIC8vIFdoaWxlIHRoZXJlIHJlbWFpbiBlbGVtZW50cyB0byBzaHVmZmxlLi4uXG4gICAgICAgIHdoaWxlICgwICE9PSBjdXJyZW50SW5kZXgpIHtcblxuICAgICAgICAgICAgLy8gUGljayBhIHJlbWFpbmluZyBlbGVtZW50Li4uXG4gICAgICAgICAgICByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGN1cnJlbnRJbmRleCk7XG4gICAgICAgICAgICBjdXJyZW50SW5kZXggLT0gMTtcblxuICAgICAgICAgICAgLy8gQW5kIHN3YXAgaXQgd2l0aCB0aGUgY3VycmVudCBlbGVtZW50LlxuICAgICAgICAgICAgdGVtcG9yYXJ5VmFsdWUgPSBhcnJheVtjdXJyZW50SW5kZXhdO1xuICAgICAgICAgICAgYXJyYXlbY3VycmVudEluZGV4XSA9IGFycmF5W3JhbmRvbUluZGV4XTtcbiAgICAgICAgICAgIGFycmF5W3JhbmRvbUluZGV4XSA9IHRlbXBvcmFyeVZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH1cblxuICAgIHZhciBTeW1ib2wgPSBmdW5jdGlvbihncmFtbWFyLCBrZXksIHJhd1J1bGVzKSB7XG4gICAgICAgIC8vIFN5bWJvbHMgY2FuIGJlIG1hZGUgd2l0aCBhIHNpbmdsZSB2YWx1ZSwgYW5kIGFycmF5LCBvciBhcnJheSBvZiBvYmplY3RzIG9mIChjb25kaXRpb25zL3ZhbHVlcylcbiAgICAgICAgdGhpcy5rZXkgPSBrZXk7XG4gICAgICAgIHRoaXMuZ3JhbW1hciA9IGdyYW1tYXI7XG4gICAgICAgIHRoaXMucmF3UnVsZXMgPSByYXdSdWxlcztcblxuICAgICAgICB0aGlzLmJhc2VSdWxlcyA9IG5ldyBSdWxlU2V0KHRoaXMuZ3JhbW1hciwgcmF3UnVsZXMpO1xuICAgICAgICB0aGlzLmNsZWFyU3RhdGUoKTtcblxuICAgIH07XG5cbiAgICBTeW1ib2wucHJvdG90eXBlLmNsZWFyU3RhdGUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAvLyBDbGVhciB0aGUgc3RhY2sgYW5kIGNsZWFyIGFsbCBydWxlc2V0IHVzYWdlc1xuICAgICAgICB0aGlzLnN0YWNrID0gW3RoaXMuYmFzZVJ1bGVzXTtcblxuICAgICAgICB0aGlzLnVzZXMgPSBbXTtcbiAgICAgICAgdGhpcy5iYXNlUnVsZXMuY2xlYXJTdGF0ZSgpO1xuICAgIH07XG5cbiAgICBTeW1ib2wucHJvdG90eXBlLnB1c2hSdWxlcyA9IGZ1bmN0aW9uKHJhd1J1bGVzKSB7XG4gICAgICAgIHZhciBydWxlcyA9IG5ldyBSdWxlU2V0KHRoaXMuZ3JhbW1hciwgcmF3UnVsZXMpO1xuICAgICAgICB0aGlzLnN0YWNrLnB1c2gocnVsZXMpO1xuICAgIH07XG5cbiAgICBTeW1ib2wucHJvdG90eXBlLnBvcFJ1bGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc3RhY2sucG9wKCk7XG4gICAgfTtcblxuICAgIFN5bWJvbC5wcm90b3R5cGUuc2VsZWN0UnVsZSA9IGZ1bmN0aW9uKG5vZGUsIGVycm9ycykge1xuICAgICAgICB0aGlzLnVzZXMucHVzaCh7XG4gICAgICAgICAgICBub2RlIDogbm9kZVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGVycm9ycy5wdXNoKFwiVGhlIHJ1bGUgc3RhY2sgZm9yICdcIiArIHRoaXMua2V5ICsgXCInIGlzIGVtcHR5LCB0b28gbWFueSBwb3BzP1wiKTtcbiAgICAgICAgICAgIHJldHVybiBcIigoXCIgKyB0aGlzLmtleSArIFwiKSlcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV0uc2VsZWN0UnVsZSgpO1xuICAgIH07XG5cbiAgICBTeW1ib2wucHJvdG90eXBlLmdldEFjdGl2ZVJ1bGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5zZWxlY3RSdWxlKCk7XG4gICAgfTtcblxuICAgIFN5bWJvbC5wcm90b3R5cGUucnVsZXNUb0pTT04gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMucmF3UnVsZXMpO1xuICAgIH07XG5cbiAgICB2YXIgR3JhbW1hciA9IGZ1bmN0aW9uKHJhdywgc2V0dGluZ3MpIHtcbiAgICAgICAgdGhpcy5tb2RpZmllcnMgPSB7fTtcbiAgICAgICAgdGhpcy5sb2FkRnJvbVJhd09iaihyYXcpO1xuICAgIH07XG5cbiAgICBHcmFtbWFyLnByb3RvdHlwZS5jbGVhclN0YXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXModGhpcy5zeW1ib2xzKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLnN5bWJvbHNba2V5c1tpXV0uY2xlYXJTdGF0ZSgpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIEdyYW1tYXIucHJvdG90eXBlLmFkZE1vZGlmaWVycyA9IGZ1bmN0aW9uKG1vZHMpIHtcblxuICAgICAgICAvLyBjb3B5IG92ZXIgdGhlIGJhc2UgbW9kaWZpZXJzXG4gICAgICAgIGZvciAodmFyIGtleSBpbiBtb2RzKSB7XG4gICAgICAgICAgICBpZiAobW9kcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RpZmllcnNba2V5XSA9IG1vZHNba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH07XG5cbiAgICBHcmFtbWFyLnByb3RvdHlwZS5sb2FkRnJvbVJhd09iaiA9IGZ1bmN0aW9uKHJhdykge1xuXG4gICAgICAgIHRoaXMucmF3ID0gcmF3O1xuICAgICAgICB0aGlzLnN5bWJvbHMgPSB7fTtcbiAgICAgICAgdGhpcy5zdWJncmFtbWFycyA9IFtdO1xuXG4gICAgICAgIGlmICh0aGlzLnJhdykge1xuICAgICAgICAgICAgLy8gQWRkIGFsbCBydWxlcyB0byB0aGUgZ3JhbW1hclxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMucmF3KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmF3Lmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zeW1ib2xzW2tleV0gPSBuZXcgU3ltYm9sKHRoaXMsIGtleSwgdGhpcy5yYXdba2V5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIEdyYW1tYXIucHJvdG90eXBlLmNyZWF0ZVJvb3QgPSBmdW5jdGlvbihydWxlKSB7XG4gICAgICAgIC8vIENyZWF0ZSBhIG5vZGUgYW5kIHN1Ym5vZGVzXG4gICAgICAgIHZhciByb290ID0gbmV3IFRyYWNlcnlOb2RlKHRoaXMsIDAsIHtcbiAgICAgICAgICAgIHR5cGUgOiAtMSxcbiAgICAgICAgICAgIHJhdyA6IHJ1bGUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiByb290O1xuICAgIH07XG5cbiAgICBHcmFtbWFyLnByb3RvdHlwZS5leHBhbmQgPSBmdW5jdGlvbihydWxlLCBhbGxvd0VzY2FwZUNoYXJzKSB7XG4gICAgICAgIHZhciByb290ID0gdGhpcy5jcmVhdGVSb290KHJ1bGUpO1xuICAgICAgICByb290LmV4cGFuZCgpO1xuICAgICAgICBpZiAoIWFsbG93RXNjYXBlQ2hhcnMpXG4gICAgICAgICAgICByb290LmNsZWFyRXNjYXBlQ2hhcnMoKTtcblxuICAgICAgICByZXR1cm4gcm9vdDtcbiAgICB9O1xuXG4gICAgR3JhbW1hci5wcm90b3R5cGUuZmxhdHRlbiA9IGZ1bmN0aW9uKHJ1bGUsIGFsbG93RXNjYXBlQ2hhcnMpIHtcbiAgICAgICAgdmFyIHJvb3QgPSB0aGlzLmV4cGFuZChydWxlLCBhbGxvd0VzY2FwZUNoYXJzKTtcblxuICAgICAgICByZXR1cm4gcm9vdC5maW5pc2hlZFRleHQ7XG4gICAgfTtcblxuICAgIEdyYW1tYXIucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuc3ltYm9scyk7XG4gICAgICAgIHZhciBzeW1ib2xKU09OID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGtleSA9IGtleXNbaV07XG4gICAgICAgICAgICBzeW1ib2xKU09OLnB1c2goJyBcIicgKyBrZXkgKyAnXCIgOiAnICsgdGhpcy5zeW1ib2xzW2tleV0ucnVsZXNUb0pTT04oKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFwie1xcblwiICsgc3ltYm9sSlNPTi5qb2luKFwiLFxcblwiKSArIFwiXFxufVwiO1xuICAgIH07XG5cbiAgICAvLyBDcmVhdGUgb3IgcHVzaCBydWxlc1xuICAgIEdyYW1tYXIucHJvdG90eXBlLnB1c2hSdWxlcyA9IGZ1bmN0aW9uKGtleSwgcmF3UnVsZXMsIHNvdXJjZUFjdGlvbikge1xuXG4gICAgICAgIGlmICh0aGlzLnN5bWJvbHNba2V5XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN5bWJvbHNba2V5XSA9IG5ldyBTeW1ib2wodGhpcywga2V5LCByYXdSdWxlcyk7XG4gICAgICAgICAgICBpZiAoc291cmNlQWN0aW9uKVxuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sc1trZXldLmlzRHluYW1pYyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN5bWJvbHNba2V5XS5wdXNoUnVsZXMocmF3UnVsZXMpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIEdyYW1tYXIucHJvdG90eXBlLnBvcFJ1bGVzID0gZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIGlmICghdGhpcy5zeW1ib2xzW2tleV0pXG4gICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKFwiQ2FuJ3QgcG9wOiBubyBzeW1ib2wgZm9yIGtleSBcIiArIGtleSk7XG4gICAgICAgIHRoaXMuc3ltYm9sc1trZXldLnBvcFJ1bGVzKCk7XG4gICAgfTtcblxuICAgIEdyYW1tYXIucHJvdG90eXBlLnNlbGVjdFJ1bGUgPSBmdW5jdGlvbihrZXksIG5vZGUsIGVycm9ycykge1xuICAgICAgICBpZiAodGhpcy5zeW1ib2xzW2tleV0pIHtcbiAgICAgICAgICAgIHZhciBydWxlID0gdGhpcy5zeW1ib2xzW2tleV0uc2VsZWN0UnVsZShub2RlLCBlcnJvcnMpO1xuXG4gICAgICAgICAgICByZXR1cm4gcnVsZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZhaWxvdmVyIHRvIGFsdGVybmF0aXZlIHN1YmdyYW1tYXJzXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zdWJncmFtbWFycy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zdWJncmFtbWFyc1tpXS5zeW1ib2xzW2tleV0pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3ViZ3JhbW1hcnNbaV0uc3ltYm9sc1trZXldLnNlbGVjdFJ1bGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vIHN5bWJvbD9cbiAgICAgICAgZXJyb3JzLnB1c2goXCJObyBzeW1ib2wgZm9yICdcIiArIGtleSArIFwiJ1wiKTtcbiAgICAgICAgcmV0dXJuIFwiKChcIiArIGtleSArIFwiKSlcIjtcbiAgICB9O1xuXG4gICAgLy8gUGFyc2VzIGEgcGxhaW50ZXh0IHJ1bGUgaW4gdGhlIHRyYWNlcnkgc3ludGF4XG4gICAgdHJhY2VyeSA9IHtcblxuICAgICAgICBjcmVhdGVHcmFtbWFyIDogZnVuY3Rpb24ocmF3KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEdyYW1tYXIocmF3KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBQYXJzZSB0aGUgY29udGVudHMgb2YgYSB0YWdcbiAgICAgICAgcGFyc2VUYWcgOiBmdW5jdGlvbih0YWdDb250ZW50cykge1xuXG4gICAgICAgICAgICB2YXIgcGFyc2VkID0ge1xuICAgICAgICAgICAgICAgIHN5bWJvbCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBwcmVhY3Rpb25zIDogW10sXG4gICAgICAgICAgICAgICAgcG9zdGFjdGlvbnMgOiBbXSxcbiAgICAgICAgICAgICAgICBtb2RpZmllcnMgOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBzZWN0aW9ucyA9IHRyYWNlcnkucGFyc2UodGFnQ29udGVudHMpO1xuICAgICAgICAgICAgdmFyIHN5bWJvbFNlY3Rpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25zW2ldLnR5cGUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN5bWJvbFNlY3Rpb24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VjdGlvbiA9IHNlY3Rpb25zW2ldLnJhdztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IChcIm11bHRpcGxlIG1haW4gc2VjdGlvbnMgaW4gXCIgKyB0YWdDb250ZW50cyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwYXJzZWQucHJlYWN0aW9ucy5wdXNoKHNlY3Rpb25zW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzeW1ib2xTZWN0aW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAvLyAgIHRocm93IChcIm5vIG1haW4gc2VjdGlvbiBpbiBcIiArIHRhZ0NvbnRlbnRzKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBzeW1ib2xTZWN0aW9uLnNwbGl0KFwiLlwiKTtcbiAgICAgICAgICAgICAgICBwYXJzZWQuc3ltYm9sID0gY29tcG9uZW50c1swXTtcbiAgICAgICAgICAgICAgICBwYXJzZWQubW9kaWZpZXJzID0gY29tcG9uZW50cy5zbGljZSgxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwYXJzZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcGFyc2UgOiBmdW5jdGlvbihydWxlKSB7XG4gICAgICAgICAgICB2YXIgZGVwdGggPSAwO1xuICAgICAgICAgICAgdmFyIGluVGFnID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgc2VjdGlvbnMgPSBbXTtcbiAgICAgICAgICAgIHZhciBlc2NhcGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHZhciBlcnJvcnMgPSBbXTtcbiAgICAgICAgICAgIHZhciBzdGFydCA9IDA7XG5cbiAgICAgICAgICAgIHZhciBlc2NhcGVkU3Vic3RyaW5nID0gXCJcIjtcbiAgICAgICAgICAgIHZhciBsYXN0RXNjYXBlZENoYXIgPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgICAgIGlmIChydWxlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlY3Rpb25zID0gW107XG4gICAgICAgICAgICAgICAgc2VjdGlvbnMuZXJyb3JzID0gZXJyb3JzO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlY3Rpb25zO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVTZWN0aW9uKHN0YXJ0LCBlbmQsIHR5cGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZW5kIC0gc3RhcnQgPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goc3RhcnQgKyBcIjogZW1wdHkgdGFnXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gMilcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKHN0YXJ0ICsgXCI6IGVtcHR5IGFjdGlvblwiKTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgcmF3U3Vic3RyaW5nO1xuICAgICAgICAgICAgICAgIGlmIChsYXN0RXNjYXBlZENoYXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICByYXdTdWJzdHJpbmcgPSBlc2NhcGVkU3Vic3RyaW5nICsgXCJcXFxcXCIgKyBydWxlLnN1YnN0cmluZyhsYXN0RXNjYXBlZENoYXIgKyAxLCBlbmQpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmF3U3Vic3RyaW5nID0gcnVsZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNlY3Rpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0eXBlIDogdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgcmF3IDogcmF3U3Vic3RyaW5nXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbGFzdEVzY2FwZWRDaGFyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGVzY2FwZWRTdWJzdHJpbmcgPSBcIlwiO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBydWxlLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWVzY2FwZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBydWxlLmNoYXJBdChpKTtcblxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2goYykge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEVudGVyIGEgZGVlcGVyIGJyYWNrZXRlZCBzZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ1snOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlcHRoID09PSAwICYmICFpblRhZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFydCA8IGkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVNlY3Rpb24oc3RhcnQsIGksIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXB0aCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnXSc6XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXB0aC0tO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmQgYSBicmFja2V0ZWQgc2VjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlcHRoID09PSAwICYmICFpblRhZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVNlY3Rpb24oc3RhcnQsIGksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAvLyBIYXNodGFnXG4gICAgICAgICAgICAgICAgICAgIC8vICAgaWdub3JlIGlmIG5vdCBhdCBkZXB0aCAwLCB0aGF0IG1lYW5zIHdlIGFyZSBpbiBhIGJyYWNrZXRcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnIyc6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVwdGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5UYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlU2VjdGlvbihzdGFydCwgaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0IDwgaSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVNlY3Rpb24oc3RhcnQsIGksIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGkgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpblRhZyA9ICFpblRhZztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ1xcXFwnOlxuICAgICAgICAgICAgICAgICAgICAgICAgZXNjYXBlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBlc2NhcGVkU3Vic3RyaW5nID0gZXNjYXBlZFN1YnN0cmluZyArIHJ1bGUuc3Vic3RyaW5nKHN0YXJ0LCBpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0RXNjYXBlZENoYXIgPSBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlc2NhcGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN0YXJ0IDwgcnVsZS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgY3JlYXRlU2VjdGlvbihzdGFydCwgcnVsZS5sZW5ndGgsIDApO1xuXG4gICAgICAgICAgICBpZiAoaW5UYWcpIHtcbiAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChcIlVuY2xvc2VkIHRhZ1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkZXB0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChcIlRvbyBtYW55IFtcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGVwdGggPCAwKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goXCJUb28gbWFueSBdXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTdHJpcCBvdXQgZW1wdHkgcGxhaW50ZXh0IHNlY3Rpb25zXG5cbiAgICAgICAgICAgIHNlY3Rpb25zID0gc2VjdGlvbnMuZmlsdGVyKGZ1bmN0aW9uKHNlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbi50eXBlID09PSAwICYmIHNlY3Rpb24ucmF3Lmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzZWN0aW9ucy5lcnJvcnMgPSBlcnJvcnM7XG4gICAgICAgICAgICByZXR1cm4gc2VjdGlvbnM7XG4gICAgICAgIH0sXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGlzVm93ZWwoYykge1xuICAgICAgICB2YXIgYzIgPSBjLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiAoYzIgPT09ICdhJykgfHwgKGMyID09PSAnZScpIHx8IChjMiA9PT0gJ2knKSB8fCAoYzIgPT09ICdvJykgfHwgKGMyID09PSAndScpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBpc0FscGhhTnVtKGMpIHtcbiAgICAgICAgcmV0dXJuIChjID49ICdhJyAmJiBjIDw9ICd6JykgfHwgKGMgPj0gJ0EnICYmIGMgPD0gJ1onKSB8fCAoYyA+PSAnMCcgJiYgYyA8PSAnOScpO1xuICAgIH07XG4gICAgZnVuY3Rpb24gZXNjYXBlUmVnRXhwKHN0cikge1xuICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoLyhbLiorP149IToke30oKXxcXFtcXF1cXC9cXFxcXSkvZywgXCJcXFxcJDFcIik7XG4gICAgfVxuXG4gICAgdmFyIGJhc2VFbmdNb2RpZmllcnMgPSB7XG5cbiAgICAgICAgcmVwbGFjZSA6IGZ1bmN0aW9uKHMsIHBhcmFtcykge1xuICAgICAgICAgICAgLy9odHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzExNDQ3ODMvcmVwbGFjaW5nLWFsbC1vY2N1cnJlbmNlcy1vZi1hLXN0cmluZy1pbi1qYXZhc2NyaXB0XG4gICAgICAgICAgICByZXR1cm4gcy5yZXBsYWNlKG5ldyBSZWdFeHAoZXNjYXBlUmVnRXhwKHBhcmFtc1swXSksICdnJyksIHBhcmFtc1sxXSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FwaXRhbGl6ZUFsbCA6IGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgICAgIHZhciBzMiA9IFwiXCI7XG4gICAgICAgICAgICB2YXIgY2FwTmV4dCA9IHRydWU7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgIGlmICghaXNBbHBoYU51bShzLmNoYXJBdChpKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FwTmV4dCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHMyICs9IHMuY2hhckF0KGkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY2FwTmV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgczIgKz0gcy5jaGFyQXQoaSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzMiArPSBzLmNoYXJBdChpKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FwTmV4dCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gczI7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FwaXRhbGl6ZSA6IGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgICAgIHJldHVybiBzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcy5zdWJzdHJpbmcoMSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYSA6IGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgICAgIGlmIChzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAocy5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSA9PT0gJ3UnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzLmNoYXJBdCgyKS50b0xvd2VyQ2FzZSgpID09PSAnaScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiYSBcIiArIHM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNWb3dlbChzLmNoYXJBdCgwKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiYW4gXCIgKyBzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIFwiYSBcIiArIHM7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBmaXJzdFMgOiBmdW5jdGlvbihzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzKTtcbiAgICAgICAgICAgIHZhciBzMiA9IHMuc3BsaXQoXCIgXCIpO1xuXG4gICAgICAgICAgICB2YXIgZmluaXNoZWQgPSBiYXNlRW5nTW9kaWZpZXJzLnMoczJbMF0pICsgXCIgXCIgKyBzMi5zbGljZSgxKS5qb2luKFwiIFwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGZpbmlzaGVkKTtcbiAgICAgICAgICAgIHJldHVybiBmaW5pc2hlZDtcbiAgICAgICAgfSxcblxuICAgICAgICBzIDogZnVuY3Rpb24ocykge1xuICAgICAgICAgICAgc3dpdGNoIChzLmNoYXJBdChzLmxlbmd0aCAtMSkpIHtcbiAgICAgICAgICAgIGNhc2UgJ3MnOlxuICAgICAgICAgICAgICAgIHJldHVybiBzICsgXCJlc1wiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnaCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBcImVzXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd4JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gcyArIFwiZXNcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3knOlxuICAgICAgICAgICAgICAgIGlmICghaXNWb3dlbChzLmNoYXJBdChzLmxlbmd0aCAtIDIpKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMuc3Vic3RyaW5nKDAsIHMubGVuZ3RoIC0gMSkgKyBcImllc1wiO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBcInNcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBcInNcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZWQgOiBmdW5jdGlvbihzKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHMuY2hhckF0KHMubGVuZ3RoIC0xKSkge1xuICAgICAgICAgICAgY2FzZSAncyc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBcImVkXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdlJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gcyArIFwiZFwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnaCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBcImVkXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd4JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gcyArIFwiZWRcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3knOlxuICAgICAgICAgICAgICAgIGlmICghaXNWb3dlbChzLmNoYXJBdChzLmxlbmd0aCAtIDIpKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMuc3Vic3RyaW5nKDAsIHMubGVuZ3RoIC0gMSkgKyBcImllZFwiO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBcImRcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBcImVkXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdHJhY2VyeS5iYXNlRW5nTW9kaWZpZXJzID0gYmFzZUVuZ01vZGlmaWVyczsgXG4gICAgLy8gRXh0ZXJuYWxpemVcbiAgICB0cmFjZXJ5LlRyYWNlcnlOb2RlID0gVHJhY2VyeU5vZGU7XG5cbiAgICB0cmFjZXJ5LkdyYW1tYXIgPSBHcmFtbWFyO1xuICAgIHRyYWNlcnkuU3ltYm9sID0gU3ltYm9sO1xuICAgIHRyYWNlcnkuUnVsZVNldCA9IFJ1bGVTZXQ7XG4gICAgcmV0dXJuIHRyYWNlcnk7XG59KCk7XG5cbm1vZHVsZS5leHBvcnRzID0gdHJhY2VyeTsgIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIlwidXNlIHN0cmljdFwiO1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgbGV0IHRyYWNlcnkgPSByZXF1aXJlKCd0cmFjZXJ5LWdyYW1tYXInKTtcclxuICAgIGxldCBncmFtbWFyID0gdHJhY2VyeS5jcmVhdGVHcmFtbWFyKEpTT04ucGFyc2UoR01fZ2V0UmVzb3VyY2VUZXh0KFwiY0pTT05cIikpKTtcclxuICAgIGdyYW1tYXIuYWRkTW9kaWZpZXJzKHRyYWNlcnkuYmFzZUVuZ01vZGlmaWVycyk7XHJcbiAgICBjb25zb2xlLmxvZyhncmFtbWFyLmZsYXR0ZW4oXCJhbzNleDogI29yaWdpbiNcIikpO1xyXG59KSgpO1xyXG4iXSwibmFtZXMiOlsidHJhY2VyeSIsIlRyYWNlcnlOb2RlIiwicGFyZW50IiwiY2hpbGRJbmRleCIsInNldHRpbmdzIiwidGhpcyIsImVycm9ycyIsInVuZGVmaW5lZCIsInJhdyIsInB1c2giLCJHcmFtbWFyIiwiZ3JhbW1hciIsImRlcHRoIiwidHlwZSIsImlzRXhwYW5kZWQiLCJOb2RlQWN0aW9uIiwibm9kZSIsInNlY3Rpb25zIiwic3BsaXQiLCJ0YXJnZXQiLCJsZW5ndGgiLCJydWxlIiwiUnVsZVNldCIsImZhbGxvZmYiLCJBcnJheSIsImlzQXJyYXkiLCJkZWZhdWx0UnVsZXMiLCJTdHJpbmciLCJwcm90b3R5cGUiLCJ0b1N0cmluZyIsImV4cGFuZENoaWxkcmVuIiwiY2hpbGRSdWxlIiwicHJldmVudFJlY3Vyc2lvbiIsImNoaWxkcmVuIiwiZmluaXNoZWRUZXh0IiwicGFyc2UiLCJjb25jYXQiLCJpIiwiZXhwYW5kIiwiZXhwYW5zaW9uRXJyb3JzIiwicHJlYWN0aW9ucyIsInBvc3RhY3Rpb25zIiwicGFyc2VkIiwicGFyc2VUYWciLCJzeW1ib2wiLCJtb2RpZmllcnMiLCJjcmVhdGVVbmRvIiwiYWN0aXZhdGUiLCJzZWxlY3RlZFJ1bGUiLCJzZWxlY3RSdWxlIiwibW9kTmFtZSIsIm1vZFBhcmFtcyIsImluZGV4T2YiLCJyZXN1bHRzIiwiZXhlYyIsInN1YnN0cmluZyIsIm1vZCIsImFjdGlvbiIsImNsZWFyRXNjYXBlQ2hhcnMiLCJyZXBsYWNlIiwicnVsZVNlY3Rpb25zIiwiZmluaXNoZWRSdWxlcyIsInJ1bGVOb2RlcyIsIm4iLCJwdXNoUnVsZXMiLCJwb3BSdWxlcyIsImZsYXR0ZW4iLCJ0b1RleHQiLCJjb25kaXRpb25hbFJ1bGUiLCJ2YWx1ZSIsImNvbmRpdGlvbmFsVmFsdWVzIiwidiIsInJhbmtpbmciLCJpbmRleCIsImRpc3RyaWJ1dGlvbiIsInNodWZmbGVkRGVjayIsImFycmF5IiwidGVtcG9yYXJ5VmFsdWUiLCJyYW5kb21JbmRleCIsImN1cnJlbnRJbmRleCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImZ5c2h1ZmZsZSIsImFwcGx5IiwibWFwIiwiTnVtYmVyIiwiY2FsbCIsInBvcCIsInBvdyIsImRlZmF1bHRVc2VzIiwiY2xlYXJTdGF0ZSIsIlN5bWJvbCIsImtleSIsInJhd1J1bGVzIiwiYmFzZVJ1bGVzIiwic3RhY2siLCJ1c2VzIiwicnVsZXMiLCJnZXRBY3RpdmVSdWxlcyIsInJ1bGVzVG9KU09OIiwiSlNPTiIsInN0cmluZ2lmeSIsImxvYWRGcm9tUmF3T2JqIiwiaXNWb3dlbCIsImMiLCJjMiIsInRvTG93ZXJDYXNlIiwia2V5cyIsIk9iamVjdCIsInN5bWJvbHMiLCJhZGRNb2RpZmllcnMiLCJtb2RzIiwiaGFzT3duUHJvcGVydHkiLCJzdWJncmFtbWFycyIsImNyZWF0ZVJvb3QiLCJhbGxvd0VzY2FwZUNoYXJzIiwicm9vdCIsInRvSlNPTiIsInN5bWJvbEpTT04iLCJqb2luIiwic291cmNlQWN0aW9uIiwiaXNEeW5hbWljIiwiYmFzZUVuZ01vZGlmaWVycyIsInMiLCJwYXJhbXMiLCJSZWdFeHAiLCJjYXBpdGFsaXplQWxsIiwiczIiLCJjYXBOZXh0IiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJjYXBpdGFsaXplIiwiYSIsImZpcnN0UyIsImNvbnNvbGUiLCJsb2ciLCJmaW5pc2hlZCIsInNsaWNlIiwiZWQiLCJjcmVhdGVHcmFtbWFyIiwidGFnQ29udGVudHMiLCJzeW1ib2xTZWN0aW9uIiwiY29tcG9uZW50cyIsImluVGFnIiwiZXNjYXBlZCIsInN0YXJ0IiwiZXNjYXBlZFN1YnN0cmluZyIsImxhc3RFc2NhcGVkQ2hhciIsImNyZWF0ZVNlY3Rpb24iLCJlbmQiLCJyYXdTdWJzdHJpbmciLCJmaWx0ZXIiLCJzZWN0aW9uIiwibW9kdWxlIiwiZXhwb3J0cyIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJHTV9nZXRSZXNvdXJjZVRleHQiXSwic291cmNlUm9vdCI6IiJ9