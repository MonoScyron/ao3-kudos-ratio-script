// ==UserScript==
// @name                AO3 Comments Dropdown (WIP)
// @namespace           https://github.com/MonoScyron/ao3-scripts
// @version             0.0.2
// @description         Dropdown button for random nice commments.
// @author              MonoScyron
// @updateURL           https://raw.githubusercontent.com/MonoScyron/ao3-scripts/main/dist/ao3-comments-dropdown.js
// @downloadURL         https://raw.githubusercontent.com/MonoScyron/ao3-scripts/main/dist/ao3-comments-dropdown.js
// @match               https://archiveofourown.org/works/*
// @match               https://archiveofourown.org/chapters/*
// @icon                https://archiveofourown.org/images/ao3_logos/logo_42.png
// @resource cJSON      https://raw.githubusercontent.com/MonoScyron/ao3-scripts/main/json/comments.json
// @grant               GM_getResourceText
// @noframes
// ==/UserScript==
(()=>{var t={451:t=>{var e=function(){var t=function(t,s,i){this.errors=[],void 0===i.raw&&(this.errors.push("Empty input for node"),i.raw=""),t instanceof e.Grammar?(this.grammar=t,this.parent=null,this.depth=0,this.childIndex=0):(this.grammar=t.grammar,this.parent=t,this.depth=t.depth+1,this.childIndex=s),this.raw=i.raw,this.type=i.type,this.isExpanded=!1,this.grammar||this.errors.push("No grammar specified for this node "+this)};function s(t,e){this.node=t;var s=e.split(":");this.target=s[0],1===s.length?this.type=2:(this.rule=s[1],"POP"===this.rule?this.type=1:this.type=0)}function i(t,e){this.raw=e,this.grammar=t,this.falloff=1,Array.isArray(e)?this.defaultRules=e:("string"==typeof e||e instanceof String)&&(this.defaultRules=[e])}t.prototype.toString=function(){return"Node('"+this.raw+"' "+this.type+" d:"+this.depth+")"},t.prototype.expandChildren=function(s,i){if(this.children=[],this.finishedText="",this.childRule=s,void 0!==this.childRule){var r=e.parse(s);r.errors.length>0&&(this.errors=this.errors.concat(r.errors));for(var n=0;n<r.length;n++)this.children[n]=new t(this,n,r[n]),i||this.children[n].expand(i),this.finishedText+=this.children[n].finishedText}else this.errors.push("No child rule provided, can't expand children")},t.prototype.expand=function(t){if(!this.isExpanded)switch(this.isExpanded=!0,this.expansionErrors=[],this.type){case-1:this.expandChildren(this.raw,t);break;case 0:this.finishedText=this.raw;break;case 1:this.preactions=[],this.postactions=[];var i=e.parseTag(this.raw);this.symbol=i.symbol,this.modifiers=i.modifiers;for(var r=0;r<i.preactions.length;r++)this.preactions[r]=new s(this,i.preactions[r].raw);for(r=0;r<i.postactions.length;r++);for(r=0;r<this.preactions.length;r++)0===this.preactions[r].type&&this.postactions.push(this.preactions[r].createUndo());for(r=0;r<this.preactions.length;r++)this.preactions[r].activate();this.finishedText=this.raw;var n=this.grammar.selectRule(this.symbol,this,this.errors);for(this.expandChildren(n,t),r=0;r<this.modifiers.length;r++){var a=this.modifiers[r],o=[];if(a.indexOf("(")>0){var h=/\(([^)]+)\)/.exec(this.modifiers[r]);!h||h.length<2||(o=h[1].split(","),a=this.modifiers[r].substring(0,a.indexOf("(")))}var l=this.grammar.modifiers[a];l?this.finishedText=l(this.finishedText,o):(this.errors.push("Missing modifier "+a),this.finishedText+="((."+a+"))")}for(r=0;r<this.postactions.length;r++)this.postactions[r].activate();break;case 2:this.action=new s(this,this.raw),this.action.activate(),this.finishedText=""}},t.prototype.clearEscapeChars=function(){this.finishedText=this.finishedText.replace(/\\\\/g,"DOUBLEBACKSLASH").replace(/\\/g,"").replace(/DOUBLEBACKSLASH/g,"\\")},s.prototype.createUndo=function(){return 0===this.type?new s(this.node,this.target+":POP"):null},s.prototype.activate=function(){var e=this.node.grammar;switch(this.type){case 0:this.ruleSections=this.rule.split(","),this.finishedRules=[],this.ruleNodes=[];for(var s=0;s<this.ruleSections.length;s++){var i=new t(e,0,{type:-1,raw:this.ruleSections[s]});i.expand(),this.finishedRules.push(i.finishedText)}e.pushRules(this.target,this.finishedRules,this);break;case 1:e.popRules(this.target);break;case 2:e.flatten(this.target,!0)}},s.prototype.toText=function(){switch(this.type){case 0:return this.target+":"+this.rule;case 1:return this.target+":POP";case 2:return"((some function))";default:return"((Unknown Action))"}},i.prototype.selectRule=function(t){if(this.conditionalRule){var e=this.grammar.expand(this.conditionalRule,!0);if(this.conditionalValues[e]&&null!=(i=this.conditionalValues[e].selectRule(t)))return i}if(this.ranking)for(var s=0;s<this.ranking.length;s++){var i;if(null!=(i=this.ranking.selectRule()))return i}if(void 0!==this.defaultRules){var r=0,n=this.distribution;switch(n||(n=this.grammar.distribution),n){case"shuffle":this.shuffledDeck&&0!==this.shuffledDeck.length||(this.shuffledDeck=function(t,e){for(var s,i,r=t.length;0!==r;)i=Math.floor(Math.random()*r),s=t[r-=1],t[r]=t[i],t[i]=s;return t}(Array.apply(null,{length:this.defaultRules.length}).map(Number.call,Number),this.falloff)),r=this.shuffledDeck.pop();break;case"weighted":t.push("Weighted distribution not yet implemented");break;case"falloff":t.push("Falloff distribution not yet implemented");break;default:r=Math.floor(Math.pow(Math.random(),this.falloff)*this.defaultRules.length)}return this.defaultUses||(this.defaultUses=[]),this.defaultUses[r]=++this.defaultUses[r]||1,this.defaultRules[r]}return t.push("No default rules defined for "+this),null},i.prototype.clearState=function(){this.defaultUses&&(this.defaultUses=[])};var r=function(t,e,s){this.key=e,this.grammar=t,this.rawRules=s,this.baseRules=new i(this.grammar,s),this.clearState()};r.prototype.clearState=function(){this.stack=[this.baseRules],this.uses=[],this.baseRules.clearState()},r.prototype.pushRules=function(t){var e=new i(this.grammar,t);this.stack.push(e)},r.prototype.popRules=function(){this.stack.pop()},r.prototype.selectRule=function(t,e){return this.uses.push({node:t}),0===this.stack.length?(e.push("The rule stack for '"+this.key+"' is empty, too many pops?"),"(("+this.key+"))"):this.stack[this.stack.length-1].selectRule()},r.prototype.getActiveRules=function(){return 0===this.stack.length?null:this.stack[this.stack.length-1].selectRule()},r.prototype.rulesToJSON=function(){return JSON.stringify(this.rawRules)};var n=function(t,e){this.modifiers={},this.loadFromRawObj(t)};function a(t){var e=t.toLowerCase();return"a"===e||"e"===e||"i"===e||"o"===e||"u"===e}n.prototype.clearState=function(){for(var t=Object.keys(this.symbols),e=0;e<t.length;e++)this.symbols[t[e]].clearState()},n.prototype.addModifiers=function(t){for(var e in t)t.hasOwnProperty(e)&&(this.modifiers[e]=t[e])},n.prototype.loadFromRawObj=function(t){if(this.raw=t,this.symbols={},this.subgrammars=[],this.raw)for(var e in this.raw)this.raw.hasOwnProperty(e)&&(this.symbols[e]=new r(this,e,this.raw[e]))},n.prototype.createRoot=function(e){return new t(this,0,{type:-1,raw:e})},n.prototype.expand=function(t,e){var s=this.createRoot(t);return s.expand(),e||s.clearEscapeChars(),s},n.prototype.flatten=function(t,e){return this.expand(t,e).finishedText},n.prototype.toJSON=function(){for(var t=Object.keys(this.symbols),e=[],s=0;s<t.length;s++){var i=t[s];e.push(' "'+i+'" : '+this.symbols[i].rulesToJSON())}return"{\n"+e.join(",\n")+"\n}"},n.prototype.pushRules=function(t,e,s){void 0===this.symbols[t]?(this.symbols[t]=new r(this,t,e),s&&(this.symbols[t].isDynamic=!0)):this.symbols[t].pushRules(e)},n.prototype.popRules=function(t){this.symbols[t]||this.errors.push("Can't pop: no symbol for key "+t),this.symbols[t].popRules()},n.prototype.selectRule=function(t,e,s){if(this.symbols[t])return this.symbols[t].selectRule(e,s);for(var i=0;i<this.subgrammars.length;i++)if(this.subgrammars[i].symbols[t])return this.subgrammars[i].symbols[t].selectRule();return s.push("No symbol for '"+t+"'"),"(("+t+"))"};var o={replace:function(t,e){return t.replace(new RegExp(e[0].replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),e[1])},capitalizeAll:function(t){for(var e,s="",i=!0,r=0;r<t.length;r++)(e=t.charAt(r))>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"?i?(s+=t.charAt(r).toUpperCase(),i=!1):s+=t.charAt(r):(i=!0,s+=t.charAt(r));return s},capitalize:function(t){return t.charAt(0).toUpperCase()+t.substring(1)},a:function(t){if(t.length>0){if("u"===t.charAt(0).toLowerCase()&&t.length>2&&"i"===t.charAt(2).toLowerCase())return"a "+t;if(a(t.charAt(0)))return"an "+t}return"a "+t},firstS:function(t){console.log(t);var e=t.split(" "),s=o.s(e[0])+" "+e.slice(1).join(" ");return console.log(s),s},s:function(t){switch(t.charAt(t.length-1)){case"s":case"h":case"x":return t+"es";case"y":return a(t.charAt(t.length-2))?t+"s":t.substring(0,t.length-1)+"ies";default:return t+"s"}},ed:function(t){switch(t.charAt(t.length-1)){case"s":case"h":case"x":default:return t+"ed";case"e":return t+"d";case"y":return a(t.charAt(t.length-2))?t+"d":t.substring(0,t.length-1)+"ied"}}};return(e={createGrammar:function(t){return new n(t)},parseTag:function(t){for(var s={symbol:void 0,preactions:[],postactions:[],modifiers:[]},i=e.parse(t),r=void 0,n=0;n<i.length;n++)if(0===i[n].type){if(void 0!==r)throw"multiple main sections in "+t;r=i[n].raw}else s.preactions.push(i[n]);if(void 0===r);else{var a=r.split(".");s.symbol=a[0],s.modifiers=a.slice(1)}return s},parse:function(t){var e=0,s=!1,i=[],r=!1,n=[],a=0,o="",h=void 0;if(null===t)return(i=[]).errors=n,i;function l(e,s,r){var a;s-e<1&&(1===r&&n.push(e+": empty tag"),2===r&&n.push(e+": empty action")),a=void 0!==h?o+"\\"+t.substring(h+1,s):t.substring(e,s),i.push({type:r,raw:a}),h=void 0,o=""}for(var u=0;u<t.length;u++)if(r)r=!1;else switch(t.charAt(u)){case"[":0!==e||s||(a<u&&l(a,u,0),a=u+1),e++;break;case"]":0!=--e||s||(l(a,u,2),a=u+1);break;case"#":0===e&&(s?(l(a,u,1),a=u+1):(a<u&&l(a,u,0),a=u+1),s=!s);break;case"\\":r=!0,o+=t.substring(a,u),a=u+1,h=u}return a<t.length&&l(a,t.length,0),s&&n.push("Unclosed tag"),e>0&&n.push("Too many ["),e<0&&n.push("Too many ]"),(i=i.filter((function(t){return 0!==t.type||0!==t.raw.length}))).errors=n,i}}).baseEngModifiers=o,e.TraceryNode=t,e.Grammar=n,e.Symbol=r,e.RuleSet=i,e}();t.exports=e}},e={};function s(i){var r=e[i];if(void 0!==r)return r.exports;var n=e[i]={exports:{}};return t[i](n,n.exports,s),n.exports}(()=>{"use strict";!function(){let t=s(451),e=t.createGrammar(JSON.parse(GM_getResourceText("cJSON")));e.addModifiers(t.baseEngModifiers);let i=document.createElement("p");i.innerHTML='\n    <p class="footnote" style="margin-bottom: -15px;">\n        <select name="nice-comment" id="nice-comment-dropdown">\n            <option selected="selected" value="clear"></option>\n            <option value="re_read">Re-read</option>\n            <option value="love">Love</option>\n            <option value="angst">Crying</option>\n        </select>\n    </p>\n    ',i=i.firstElementChild;let r=i.firstElementChild;const n=document.querySelector("textarea[id*='comment_content_for']");r.addEventListener("change",(()=>n.value=e.flatten(`#${r.value}#`)));let a=document.querySelector("form.new_comment fieldset");a.insertBefore(i,a.children[3])}()})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dkJELEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvdHJhY2VyeS1ncmFtbWFyL3RyYWNlcnkuanMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovLy8uL3NyYy9hbzMtY29tbWVudHMtZHJvcGRvd24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAYXV0aG9yIEthdGVcbiAqL1xuXG52YXIgdHJhY2VyeSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIFRyYWNlcnlOb2RlID0gZnVuY3Rpb24ocGFyZW50LCBjaGlsZEluZGV4LCBzZXR0aW5ncykge1xuICAgICAgICB0aGlzLmVycm9ycyA9IFtdO1xuXG4gICAgICAgIC8vIE5vIGlucHV0PyBBZGQgYW4gZXJyb3IsIGJ1dCBjb250aW51ZSBhbnl3YXlzXG4gICAgICAgIGlmIChzZXR0aW5ncy5yYXcgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChcIkVtcHR5IGlucHV0IGZvciBub2RlXCIpO1xuICAgICAgICAgICAgc2V0dGluZ3MucmF3ID0gXCJcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIHRoZSByb290IG5vZGUgb2YgYW4gZXhwYW5zaW9uLCBpdCB3aWxsIGhhdmUgdGhlIGdyYW1tYXIgcGFzc2VkIGFzIHRoZSAncGFyZW50J1xuICAgICAgICAvLyAgc2V0IHRoZSBncmFtbWFyIGZyb20gdGhlICdwYXJlbnQnLCBhbmQgc2V0IGFsbCBvdGhlciB2YWx1ZXMgZm9yIGEgcm9vdCBub2RlXG4gICAgICAgIGlmICggcGFyZW50IGluc3RhbmNlb2YgdHJhY2VyeS5HcmFtbWFyKSB7XG4gICAgICAgICAgICB0aGlzLmdyYW1tYXIgPSBwYXJlbnQ7XG4gICAgICAgICAgICB0aGlzLnBhcmVudCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmRlcHRoID0gMDtcbiAgICAgICAgICAgIHRoaXMuY2hpbGRJbmRleCA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmdyYW1tYXIgPSBwYXJlbnQuZ3JhbW1hcjtcbiAgICAgICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgICAgICAgICAgdGhpcy5kZXB0aCA9IHBhcmVudC5kZXB0aCArIDE7XG4gICAgICAgICAgICB0aGlzLmNoaWxkSW5kZXggPSBjaGlsZEluZGV4O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yYXcgPSBzZXR0aW5ncy5yYXc7XG4gICAgICAgIHRoaXMudHlwZSA9IHNldHRpbmdzLnR5cGU7XG4gICAgICAgIHRoaXMuaXNFeHBhbmRlZCA9IGZhbHNlO1xuXG4gICAgICAgIGlmICghdGhpcy5ncmFtbWFyKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKFwiTm8gZ3JhbW1hciBzcGVjaWZpZWQgZm9yIHRoaXMgbm9kZSBcIiArIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgVHJhY2VyeU5vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBcIk5vZGUoJ1wiICsgdGhpcy5yYXcgKyBcIicgXCIgKyB0aGlzLnR5cGUgKyBcIiBkOlwiICsgdGhpcy5kZXB0aCArIFwiKVwiO1xuICAgIH07XG5cbiAgICAvLyBFeHBhbmQgdGhlIG5vZGUgKHdpdGggdGhlIGdpdmVuIGNoaWxkIHJ1bGUpXG4gICAgLy8gIE1ha2UgY2hpbGRyZW4gaWYgdGhlIG5vZGUgaGFzIGFueVxuICAgIFRyYWNlcnlOb2RlLnByb3RvdHlwZS5leHBhbmRDaGlsZHJlbiA9IGZ1bmN0aW9uKGNoaWxkUnVsZSwgcHJldmVudFJlY3Vyc2lvbikge1xuICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XG4gICAgICAgIHRoaXMuZmluaXNoZWRUZXh0ID0gXCJcIjtcblxuICAgICAgICAvLyBTZXQgdGhlIHJ1bGUgZm9yIG1ha2luZyBjaGlsZHJlbixcbiAgICAgICAgLy8gYW5kIGV4cGFuZCBpdCBpbnRvIHNlY3Rpb25cbiAgICAgICAgdGhpcy5jaGlsZFJ1bGUgPSBjaGlsZFJ1bGU7XG4gICAgICAgIGlmICh0aGlzLmNoaWxkUnVsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB2YXIgc2VjdGlvbnMgPSB0cmFjZXJ5LnBhcnNlKGNoaWxkUnVsZSk7XG5cbiAgICAgICAgICAgIC8vIEFkZCBlcnJvcnMgdG8gdGhpc1xuICAgICAgICAgICAgaWYgKHNlY3Rpb25zLmVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMgPSB0aGlzLmVycm9ycy5jb25jYXQoc2VjdGlvbnMuZXJyb3JzKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbltpXSA9IG5ldyBUcmFjZXJ5Tm9kZSh0aGlzLCBpLCBzZWN0aW9uc1tpXSk7XG4gICAgICAgICAgICAgICAgaWYgKCFwcmV2ZW50UmVjdXJzaW9uKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLmV4cGFuZChwcmV2ZW50UmVjdXJzaW9uKTtcblxuICAgICAgICAgICAgICAgIC8vIEFkZCBpbiB0aGUgZmluaXNoZWQgdGV4dFxuICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWRUZXh0ICs9IHRoaXMuY2hpbGRyZW5baV0uZmluaXNoZWRUZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSW4gbm9ybWFsIG9wZXJhdGlvbiwgdGhpcyBzaG91bGRuJ3QgZXZlciBoYXBwZW5cbiAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goXCJObyBjaGlsZCBydWxlIHByb3ZpZGVkLCBjYW4ndCBleHBhbmQgY2hpbGRyZW5cIik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gRXhwYW5kIHRoaXMgcnVsZSAocG9zc2libHkgY3JlYXRpbmcgY2hpbGRyZW4pXG4gICAgVHJhY2VyeU5vZGUucHJvdG90eXBlLmV4cGFuZCA9IGZ1bmN0aW9uKHByZXZlbnRSZWN1cnNpb24pIHtcblxuICAgICAgICBpZiAoIXRoaXMuaXNFeHBhbmRlZCkge1xuICAgICAgICAgICAgdGhpcy5pc0V4cGFuZGVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgdGhpcy5leHBhbnNpb25FcnJvcnMgPSBbXTtcblxuICAgICAgICAgICAgLy8gVHlwZXMgb2Ygbm9kZXNcbiAgICAgICAgICAgIC8vIC0xOiByYXcsIG5lZWRzIHBhcnNpbmdcbiAgICAgICAgICAgIC8vICAwOiBQbGFpbnRleHRcbiAgICAgICAgICAgIC8vICAxOiBUYWcgKFwiI3N5bWJvbC5tb2QubW9kMi5tb2QzI1wiIG9yIFwiI1twdXNoVGFyZ2V0OnB1c2hSdWxlXXN5bWJvbC5tb2RcIilcbiAgICAgICAgICAgIC8vICAyOiBBY3Rpb24gKFwiW3B1c2hUYXJnZXQ6cHVzaFJ1bGVdLCBbcHVzaFRhcmdldDpQT1BdXCIsIG1vcmUgaW4gdGhlIGZ1dHVyZSlcblxuICAgICAgICAgICAgc3dpdGNoKHRoaXMudHlwZSkge1xuICAgICAgICAgICAgLy8gUmF3IHJ1bGVcbiAgICAgICAgICAgIGNhc2UgLTE6XG5cbiAgICAgICAgICAgICAgICB0aGlzLmV4cGFuZENoaWxkcmVuKHRoaXMucmF3LCBwcmV2ZW50UmVjdXJzaW9uKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gcGxhaW50ZXh0LCBkbyBub3RoaW5nIGJ1dCBjb3B5IHRleHQgaW50byBmaW5zaWhlZCB0ZXh0XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZFRleHQgPSB0aGlzLnJhdztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVGFnXG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgLy8gUGFyc2UgdG8gZmluZCBhbnkgYWN0aW9ucywgYW5kIGZpZ3VyZSBvdXQgd2hhdCB0aGUgc3ltYm9sIGlzXG4gICAgICAgICAgICAgICAgdGhpcy5wcmVhY3Rpb25zID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5wb3N0YWN0aW9ucyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBhcnNlZCA9IHRyYWNlcnkucGFyc2VUYWcodGhpcy5yYXcpO1xuXG4gICAgICAgICAgICAgICAgLy8gQnJlYWsgaW50byBzeW1ib2wgYWN0aW9ucyBhbmQgbW9kaWZpZXJzXG4gICAgICAgICAgICAgICAgdGhpcy5zeW1ib2wgPSBwYXJzZWQuc3ltYm9sO1xuICAgICAgICAgICAgICAgIHRoaXMubW9kaWZpZXJzID0gcGFyc2VkLm1vZGlmaWVycztcblxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhbGwgdGhlIHByZWFjdGlvbnMgZnJvbSB0aGUgcmF3IHN5bnRheFxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFyc2VkLnByZWFjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmVhY3Rpb25zW2ldID0gbmV3IE5vZGVBY3Rpb24odGhpcywgcGFyc2VkLnByZWFjdGlvbnNbaV0ucmF3KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJzZWQucG9zdGFjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICB0aGlzLnBvc3RhY3Rpb25zW2ldID0gbmV3IE5vZGVBY3Rpb24odGhpcywgcGFyc2VkLnBvc3RhY3Rpb25zW2ldLnJhdyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gTWFrZSB1bmRvIGFjdGlvbnMgZm9yIGFsbCBwcmVhY3Rpb25zIChwb3BzIGZvciBlYWNoIHB1c2gpXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnByZWFjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJlYWN0aW9uc1tpXS50eXBlID09PSAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3N0YWN0aW9ucy5wdXNoKHRoaXMucHJlYWN0aW9uc1tpXS5jcmVhdGVVbmRvKCkpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIGFsbCB0aGUgcHJlYWN0aW9uc1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wcmVhY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJlYWN0aW9uc1tpXS5hY3RpdmF0ZSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWRUZXh0ID0gdGhpcy5yYXc7XG5cbiAgICAgICAgICAgICAgICAvLyBFeHBhbmQgKHBhc3NpbmcgdGhlIG5vZGUsIHRoaXMgYWxsb3dzIHRyYWNraW5nIG9mIHJlY3Vyc2lvbiBkZXB0aClcblxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFJ1bGUgPSB0aGlzLmdyYW1tYXIuc2VsZWN0UnVsZSh0aGlzLnN5bWJvbCwgdGhpcywgdGhpcy5lcnJvcnMpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5leHBhbmRDaGlsZHJlbihzZWxlY3RlZFJ1bGUsIHByZXZlbnRSZWN1cnNpb24pO1xuXG4gICAgICAgICAgICAgICAgLy8gQXBwbHkgbW9kaWZpZXJzXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogVXBkYXRlIHBhcnNlIGZ1bmN0aW9uIHRvIG5vdCB0cmlnZ2VyIG9uIGhhc2h0YWdzIHdpdGhpbiBwYXJlbnRoZXNpcyB3aXRoaW4gdGFncyxcbiAgICAgICAgICAgICAgICAvLyAgIHNvIHRoYXQgbW9kaWZpZXIgcGFyYW1ldGVycyBjYW4gY29udGFpbiB0YWdzIFwiI3N0b3J5LnJlcGxhY2UoI3Byb3RhZ29uaXN0IywgI25ld0NoYXJhY3RlciMpI1wiXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1vZGlmaWVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbW9kTmFtZSA9IHRoaXMubW9kaWZpZXJzW2ldO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbW9kUGFyYW1zID0gW107XG4gICAgICAgICAgICAgICAgICAgIGlmIChtb2ROYW1lLmluZGV4T2YoXCIoXCIpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlZ0V4cCA9IC9cXCgoW14pXSspXFwpLztcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVG9kbzogaWdub3JlIGFueSBlc2NhcGVkIGNvbW1hcy4gIEZvciBub3csIGNvbW1hcyBhbHdheXMgc3BsaXRcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHRzID0gcmVnRXhwLmV4ZWModGhpcy5tb2RpZmllcnNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXN1bHRzIHx8IHJlc3VsdHMubGVuZ3RoIDwgMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9kUGFyYW1zID0gcmVzdWx0c1sxXS5zcGxpdChcIixcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kTmFtZSA9IHRoaXMubW9kaWZpZXJzW2ldLnN1YnN0cmluZygwLCBtb2ROYW1lLmluZGV4T2YoXCIoXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZCA9IHRoaXMuZ3JhbW1hci5tb2RpZmllcnNbbW9kTmFtZV07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gTWlzc2luZyBtb2RpZmllcj9cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFtb2QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goXCJNaXNzaW5nIG1vZGlmaWVyIFwiICsgbW9kTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmlzaGVkVGV4dCArPSBcIigoLlwiICsgbW9kTmFtZSArIFwiKSlcIjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWRUZXh0ID0gbW9kKHRoaXMuZmluaXNoZWRUZXh0LCBtb2RQYXJhbXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFBlcmZvcm0gcG9zdC1hY3Rpb25zXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBvc3RhY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9zdGFjdGlvbnNbaV0uYWN0aXZhdGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG5cbiAgICAgICAgICAgICAgICAvLyBKdXN0IGEgYmFyZSBhY3Rpb24/ICBFeHBhbmQgaXQhXG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb24gPSBuZXcgTm9kZUFjdGlvbih0aGlzLCB0aGlzLnJhdyk7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb24uYWN0aXZhdGUoKTtcblxuICAgICAgICAgICAgICAgIC8vIE5vIHZpc2libGUgdGV4dCBmb3IgYW4gYWN0aW9uXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogc29tZSB2aXNpYmxlIHRleHQgZm9yIGlmIHRoZXJlIGlzIGEgZmFpbHVyZSB0byBwZXJmb3JtIHRoZSBhY3Rpb24/XG4gICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZFRleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vY29uc29sZS53YXJuKFwiQWxyZWFkeSBleHBhbmRlZCBcIiArIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgVHJhY2VyeU5vZGUucHJvdG90eXBlLmNsZWFyRXNjYXBlQ2hhcnMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB0aGlzLmZpbmlzaGVkVGV4dCA9IHRoaXMuZmluaXNoZWRUZXh0LnJlcGxhY2UoL1xcXFxcXFxcL2csIFwiRE9VQkxFQkFDS1NMQVNIXCIpLnJlcGxhY2UoL1xcXFwvZywgXCJcIikucmVwbGFjZSgvRE9VQkxFQkFDS1NMQVNIL2csIFwiXFxcXFwiKTtcbiAgICB9O1xuXG4gICAgLy8gQW4gYWN0aW9uIHRoYXQgb2NjdXJzIHdoZW4gYSBub2RlIGlzIGV4cGFuZGVkXG4gICAgLy8gVHlwZXMgb2YgYWN0aW9uczpcbiAgICAvLyAwIFB1c2g6IFtrZXk6cnVsZV1cbiAgICAvLyAxIFBvcDogW2tleTpQT1BdXG4gICAgLy8gMiBmdW5jdGlvbjogW2Z1bmN0aW9uTmFtZShwYXJhbTAscGFyYW0xKV0gKFRPRE8hKVxuICAgIGZ1bmN0aW9uIE5vZGVBY3Rpb24obm9kZSwgcmF3KSB7XG4gICAgICAgIC8qXG4gICAgICAgICBpZiAoIW5vZGUpXG4gICAgICAgICBjb25zb2xlLndhcm4oXCJObyBub2RlIGZvciBOb2RlQWN0aW9uXCIpO1xuICAgICAgICAgaWYgKCFyYXcpXG4gICAgICAgICBjb25zb2xlLndhcm4oXCJObyByYXcgY29tbWFuZHMgZm9yIE5vZGVBY3Rpb25cIik7XG4gICAgICAgICAqL1xuXG4gICAgICAgIHRoaXMubm9kZSA9IG5vZGU7XG5cbiAgICAgICAgdmFyIHNlY3Rpb25zID0gcmF3LnNwbGl0KFwiOlwiKTtcbiAgICAgICAgdGhpcy50YXJnZXQgPSBzZWN0aW9uc1swXTtcblxuICAgICAgICAvLyBObyBjb2xvbj8gQSBmdW5jdGlvbiFcbiAgICAgICAgaWYgKHNlY3Rpb25zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gMjtcblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ29sb24/IEl0J3MgZWl0aGVyIGEgcHVzaCBvciBhIHBvcFxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucnVsZSA9IHNlY3Rpb25zWzFdO1xuICAgICAgICAgICAgaWYgKHRoaXMucnVsZSA9PT0gXCJQT1BcIikge1xuICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIE5vZGVBY3Rpb24ucHJvdG90eXBlLmNyZWF0ZVVuZG8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBOb2RlQWN0aW9uKHRoaXMubm9kZSwgdGhpcy50YXJnZXQgKyBcIjpQT1BcIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETyBOb3Qgc3VyZSBob3cgdG8gbWFrZSBVbmRvIGFjdGlvbnMgZm9yIGZ1bmN0aW9ucyBvciBQT1BzXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG5cbiAgICBOb2RlQWN0aW9uLnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZ3JhbW1hciA9IHRoaXMubm9kZS5ncmFtbWFyO1xuICAgICAgICBzd2l0Y2godGhpcy50eXBlKSB7XG4gICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgIC8vIHNwbGl0IGludG8gc2VjdGlvbnMgKHRoZSB3YXkgdG8gZGVub3RlIGFuIGFycmF5IG9mIHJ1bGVzKVxuICAgICAgICAgICAgdGhpcy5ydWxlU2VjdGlvbnMgPSB0aGlzLnJ1bGUuc3BsaXQoXCIsXCIpO1xuICAgICAgICAgICAgdGhpcy5maW5pc2hlZFJ1bGVzID0gW107XG4gICAgICAgICAgICB0aGlzLnJ1bGVOb2RlcyA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJ1bGVTZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBuID0gbmV3IFRyYWNlcnlOb2RlKGdyYW1tYXIsIDAsIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA6IC0xLFxuICAgICAgICAgICAgICAgICAgICByYXcgOiB0aGlzLnJ1bGVTZWN0aW9uc1tpXVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgbi5leHBhbmQoKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWRSdWxlcy5wdXNoKG4uZmluaXNoZWRUZXh0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVE9ETzogZXNjYXBlIGNvbW1hcyBwcm9wZXJseVxuICAgICAgICAgICAgZ3JhbW1hci5wdXNoUnVsZXModGhpcy50YXJnZXQsIHRoaXMuZmluaXNoZWRSdWxlcywgdGhpcyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgZ3JhbW1hci5wb3BSdWxlcyh0aGlzLnRhcmdldCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgZ3JhbW1hci5mbGF0dGVuKHRoaXMudGFyZ2V0LCB0cnVlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgTm9kZUFjdGlvbi5wcm90b3R5cGUudG9UZXh0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHN3aXRjaCh0aGlzLnR5cGUpIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFyZ2V0ICsgXCI6XCIgKyB0aGlzLnJ1bGU7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhcmdldCArIFwiOlBPUFwiO1xuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICByZXR1cm4gXCIoKHNvbWUgZnVuY3Rpb24pKVwiO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIFwiKChVbmtub3duIEFjdGlvbikpXCI7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gU2V0cyBvZiBydWxlc1xuICAgIC8vIENhbiBhbHNvIGNvbnRhaW4gY29uZGl0aW9uYWwgb3IgZmFsbGJhY2sgc2V0cyBvZiBydWxlc2V0cylcbiAgICBmdW5jdGlvbiBSdWxlU2V0KGdyYW1tYXIsIHJhdykge1xuICAgICAgICB0aGlzLnJhdyA9IHJhdztcbiAgICAgICAgdGhpcy5ncmFtbWFyID0gZ3JhbW1hcjtcbiAgICAgICAgdGhpcy5mYWxsb2ZmID0gMTtcblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyYXcpKSB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRSdWxlcyA9IHJhdztcbiAgICAgICAgfSBlbHNlIGlmICggdHlwZW9mIHJhdyA9PT0gJ3N0cmluZycgfHwgcmF3IGluc3RhbmNlb2YgU3RyaW5nKSB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRSdWxlcyA9IFtyYXddO1xuICAgICAgICB9IGVsc2UgaWYgKHJhdyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IHN1cHBvcnQgZm9yIGNvbmRpdGlvbmFsIGFuZCBoaWVyYXJjaGljYWwgcnVsZSBzZXRzXG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBSdWxlU2V0LnByb3RvdHlwZS5zZWxlY3RSdWxlID0gZnVuY3Rpb24oZXJyb3JzKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiR2V0IHJ1bGVcIiwgdGhpcy5yYXcpO1xuICAgICAgICAvLyBJcyB0aGVyZSBhIGNvbmRpdGlvbmFsP1xuICAgICAgICBpZiAodGhpcy5jb25kaXRpb25hbFJ1bGUpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZ3JhbW1hci5leHBhbmQodGhpcy5jb25kaXRpb25hbFJ1bGUsIHRydWUpO1xuICAgICAgICAgICAgLy8gZG9lcyB0aGlzIHZhbHVlIG1hdGNoIGFueSBvZiB0aGUgY29uZGl0aW9uYWxzP1xuICAgICAgICAgICAgaWYgKHRoaXMuY29uZGl0aW9uYWxWYWx1ZXNbdmFsdWVdKSB7XG4gICAgICAgICAgICAgICAgdmFyIHYgPSB0aGlzLmNvbmRpdGlvbmFsVmFsdWVzW3ZhbHVlXS5zZWxlY3RSdWxlKGVycm9ycyk7XG4gICAgICAgICAgICAgICAgaWYgKHYgIT09IG51bGwgJiYgdiAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE5vIHJldHVybmVkIHZhbHVlP1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSXMgdGhlcmUgYSByYW5rZWQgb3JkZXI/XG4gICAgICAgIGlmICh0aGlzLnJhbmtpbmcpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5yYW5raW5nLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHYgPSB0aGlzLnJhbmtpbmcuc2VsZWN0UnVsZSgpO1xuICAgICAgICAgICAgICAgIGlmICh2ICE9PSBudWxsICYmIHYgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHY7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFN0aWxsIG5vIHJldHVybmVkIHZhbHVlP1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdFJ1bGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICAgICAgICAvLyBTZWxlY3QgZnJvbSB0aGlzIGJhc2ljIGFycmF5IG9mIHJ1bGVzXG5cbiAgICAgICAgICAgIC8vIEdldCB0aGUgZGlzdHJpYnV0aW9uIGZyb20gdGhlIGdyYW1tYXIgaWYgdGhlcmUgaXMgbm8gb3RoZXJcbiAgICAgICAgICAgIHZhciBkaXN0cmlidXRpb24gPSB0aGlzLmRpc3RyaWJ1dGlvbjtcbiAgICAgICAgICAgIGlmICghZGlzdHJpYnV0aW9uKVxuICAgICAgICAgICAgICAgIGRpc3RyaWJ1dGlvbiA9IHRoaXMuZ3JhbW1hci5kaXN0cmlidXRpb247XG5cbiAgICAgICAgICAgIHN3aXRjaChkaXN0cmlidXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgXCJzaHVmZmxlXCI6XG5cbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYSBzaHVmZmxlIGRlc2tcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2h1ZmZsZWREZWNrIHx8IHRoaXMuc2h1ZmZsZWREZWNrLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIGFuIGFycmF5XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2h1ZmZsZWREZWNrID0gZnlzaHVmZmxlKEFycmF5LmFwcGx5KG51bGwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCA6IHRoaXMuZGVmYXVsdFJ1bGVzLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICB9KS5tYXAoTnVtYmVyLmNhbGwsIE51bWJlciksIHRoaXMuZmFsbG9mZik7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpbmRleCA9IHRoaXMuc2h1ZmZsZWREZWNrLnBvcCgpO1xuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwid2VpZ2h0ZWRcIjpcbiAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChcIldlaWdodGVkIGRpc3RyaWJ1dGlvbiBub3QgeWV0IGltcGxlbWVudGVkXCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImZhbGxvZmZcIjpcbiAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChcIkZhbGxvZmYgZGlzdHJpYnV0aW9uIG5vdCB5ZXQgaW1wbGVtZW50ZWRcIik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuXG4gICAgICAgICAgICAgICAgaW5kZXggPSBNYXRoLmZsb29yKE1hdGgucG93KE1hdGgucmFuZG9tKCksIHRoaXMuZmFsbG9mZikgKiB0aGlzLmRlZmF1bHRSdWxlcy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGVmYXVsdFVzZXMpXG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0VXNlcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5kZWZhdWx0VXNlc1tpbmRleF0gPSArK3RoaXMuZGVmYXVsdFVzZXNbaW5kZXhdIHx8IDE7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0UnVsZXNbaW5kZXhdO1xuICAgICAgICB9XG5cbiAgICAgICAgZXJyb3JzLnB1c2goXCJObyBkZWZhdWx0IHJ1bGVzIGRlZmluZWQgZm9yIFwiICsgdGhpcyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgfTtcblxuICAgIFJ1bGVTZXQucHJvdG90eXBlLmNsZWFyU3RhdGUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICBpZiAodGhpcy5kZWZhdWx0VXNlcykge1xuICAgICAgICAgICAgdGhpcy5kZWZhdWx0VXNlcyA9IFtdO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGZ5c2h1ZmZsZShhcnJheSwgZmFsbG9mZikge1xuICAgICAgICB2YXIgY3VycmVudEluZGV4ID0gYXJyYXkubGVuZ3RoLFxuICAgICAgICAgICAgdGVtcG9yYXJ5VmFsdWUsXG4gICAgICAgICAgICByYW5kb21JbmRleDtcblxuICAgICAgICAvLyBXaGlsZSB0aGVyZSByZW1haW4gZWxlbWVudHMgdG8gc2h1ZmZsZS4uLlxuICAgICAgICB3aGlsZSAoMCAhPT0gY3VycmVudEluZGV4KSB7XG5cbiAgICAgICAgICAgIC8vIFBpY2sgYSByZW1haW5pbmcgZWxlbWVudC4uLlxuICAgICAgICAgICAgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjdXJyZW50SW5kZXgpO1xuICAgICAgICAgICAgY3VycmVudEluZGV4IC09IDE7XG5cbiAgICAgICAgICAgIC8vIEFuZCBzd2FwIGl0IHdpdGggdGhlIGN1cnJlbnQgZWxlbWVudC5cbiAgICAgICAgICAgIHRlbXBvcmFyeVZhbHVlID0gYXJyYXlbY3VycmVudEluZGV4XTtcbiAgICAgICAgICAgIGFycmF5W2N1cnJlbnRJbmRleF0gPSBhcnJheVtyYW5kb21JbmRleF07XG4gICAgICAgICAgICBhcnJheVtyYW5kb21JbmRleF0gPSB0ZW1wb3JhcnlWYWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhcnJheTtcbiAgICB9XG5cbiAgICB2YXIgU3ltYm9sID0gZnVuY3Rpb24oZ3JhbW1hciwga2V5LCByYXdSdWxlcykge1xuICAgICAgICAvLyBTeW1ib2xzIGNhbiBiZSBtYWRlIHdpdGggYSBzaW5nbGUgdmFsdWUsIGFuZCBhcnJheSwgb3IgYXJyYXkgb2Ygb2JqZWN0cyBvZiAoY29uZGl0aW9ucy92YWx1ZXMpXG4gICAgICAgIHRoaXMua2V5ID0ga2V5O1xuICAgICAgICB0aGlzLmdyYW1tYXIgPSBncmFtbWFyO1xuICAgICAgICB0aGlzLnJhd1J1bGVzID0gcmF3UnVsZXM7XG5cbiAgICAgICAgdGhpcy5iYXNlUnVsZXMgPSBuZXcgUnVsZVNldCh0aGlzLmdyYW1tYXIsIHJhd1J1bGVzKTtcbiAgICAgICAgdGhpcy5jbGVhclN0YXRlKCk7XG5cbiAgICB9O1xuXG4gICAgU3ltYm9sLnByb3RvdHlwZS5jbGVhclN0YXRlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgLy8gQ2xlYXIgdGhlIHN0YWNrIGFuZCBjbGVhciBhbGwgcnVsZXNldCB1c2FnZXNcbiAgICAgICAgdGhpcy5zdGFjayA9IFt0aGlzLmJhc2VSdWxlc107XG5cbiAgICAgICAgdGhpcy51c2VzID0gW107XG4gICAgICAgIHRoaXMuYmFzZVJ1bGVzLmNsZWFyU3RhdGUoKTtcbiAgICB9O1xuXG4gICAgU3ltYm9sLnByb3RvdHlwZS5wdXNoUnVsZXMgPSBmdW5jdGlvbihyYXdSdWxlcykge1xuICAgICAgICB2YXIgcnVsZXMgPSBuZXcgUnVsZVNldCh0aGlzLmdyYW1tYXIsIHJhd1J1bGVzKTtcbiAgICAgICAgdGhpcy5zdGFjay5wdXNoKHJ1bGVzKTtcbiAgICB9O1xuXG4gICAgU3ltYm9sLnByb3RvdHlwZS5wb3BSdWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnN0YWNrLnBvcCgpO1xuICAgIH07XG5cbiAgICBTeW1ib2wucHJvdG90eXBlLnNlbGVjdFJ1bGUgPSBmdW5jdGlvbihub2RlLCBlcnJvcnMpIHtcbiAgICAgICAgdGhpcy51c2VzLnB1c2goe1xuICAgICAgICAgICAgbm9kZSA6IG5vZGVcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBlcnJvcnMucHVzaChcIlRoZSBydWxlIHN0YWNrIGZvciAnXCIgKyB0aGlzLmtleSArIFwiJyBpcyBlbXB0eSwgdG9vIG1hbnkgcG9wcz9cIik7XG4gICAgICAgICAgICByZXR1cm4gXCIoKFwiICsgdGhpcy5rZXkgKyBcIikpXCI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIDFdLnNlbGVjdFJ1bGUoKTtcbiAgICB9O1xuXG4gICAgU3ltYm9sLnByb3RvdHlwZS5nZXRBY3RpdmVSdWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV0uc2VsZWN0UnVsZSgpO1xuICAgIH07XG5cbiAgICBTeW1ib2wucHJvdG90eXBlLnJ1bGVzVG9KU09OID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnJhd1J1bGVzKTtcbiAgICB9O1xuXG4gICAgdmFyIEdyYW1tYXIgPSBmdW5jdGlvbihyYXcsIHNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMubW9kaWZpZXJzID0ge307XG4gICAgICAgIHRoaXMubG9hZEZyb21SYXdPYmoocmF3KTtcbiAgICB9O1xuXG4gICAgR3JhbW1hci5wcm90b3R5cGUuY2xlYXJTdGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuc3ltYm9scyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5zeW1ib2xzW2tleXNbaV1dLmNsZWFyU3RhdGUoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBHcmFtbWFyLnByb3RvdHlwZS5hZGRNb2RpZmllcnMgPSBmdW5jdGlvbihtb2RzKSB7XG5cbiAgICAgICAgLy8gY29weSBvdmVyIHRoZSBiYXNlIG1vZGlmaWVyc1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gbW9kcykge1xuICAgICAgICAgICAgaWYgKG1vZHMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIHRoaXMubW9kaWZpZXJzW2tleV0gPSBtb2RzW2tleV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICB9O1xuXG4gICAgR3JhbW1hci5wcm90b3R5cGUubG9hZEZyb21SYXdPYmogPSBmdW5jdGlvbihyYXcpIHtcblxuICAgICAgICB0aGlzLnJhdyA9IHJhdztcbiAgICAgICAgdGhpcy5zeW1ib2xzID0ge307XG4gICAgICAgIHRoaXMuc3ViZ3JhbW1hcnMgPSBbXTtcblxuICAgICAgICBpZiAodGhpcy5yYXcpIHtcbiAgICAgICAgICAgIC8vIEFkZCBhbGwgcnVsZXMgdG8gdGhlIGdyYW1tYXJcbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLnJhdykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJhdy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sc1trZXldID0gbmV3IFN5bWJvbCh0aGlzLCBrZXksIHRoaXMucmF3W2tleV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBHcmFtbWFyLnByb3RvdHlwZS5jcmVhdGVSb290ID0gZnVuY3Rpb24ocnVsZSkge1xuICAgICAgICAvLyBDcmVhdGUgYSBub2RlIGFuZCBzdWJub2Rlc1xuICAgICAgICB2YXIgcm9vdCA9IG5ldyBUcmFjZXJ5Tm9kZSh0aGlzLCAwLCB7XG4gICAgICAgICAgICB0eXBlIDogLTEsXG4gICAgICAgICAgICByYXcgOiBydWxlLFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcm9vdDtcbiAgICB9O1xuXG4gICAgR3JhbW1hci5wcm90b3R5cGUuZXhwYW5kID0gZnVuY3Rpb24ocnVsZSwgYWxsb3dFc2NhcGVDaGFycykge1xuICAgICAgICB2YXIgcm9vdCA9IHRoaXMuY3JlYXRlUm9vdChydWxlKTtcbiAgICAgICAgcm9vdC5leHBhbmQoKTtcbiAgICAgICAgaWYgKCFhbGxvd0VzY2FwZUNoYXJzKVxuICAgICAgICAgICAgcm9vdC5jbGVhckVzY2FwZUNoYXJzKCk7XG5cbiAgICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgfTtcblxuICAgIEdyYW1tYXIucHJvdG90eXBlLmZsYXR0ZW4gPSBmdW5jdGlvbihydWxlLCBhbGxvd0VzY2FwZUNoYXJzKSB7XG4gICAgICAgIHZhciByb290ID0gdGhpcy5leHBhbmQocnVsZSwgYWxsb3dFc2NhcGVDaGFycyk7XG5cbiAgICAgICAgcmV0dXJuIHJvb3QuZmluaXNoZWRUZXh0O1xuICAgIH07XG5cbiAgICBHcmFtbWFyLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLnN5bWJvbHMpO1xuICAgICAgICB2YXIgc3ltYm9sSlNPTiA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBrZXkgPSBrZXlzW2ldO1xuICAgICAgICAgICAgc3ltYm9sSlNPTi5wdXNoKCcgXCInICsga2V5ICsgJ1wiIDogJyArIHRoaXMuc3ltYm9sc1trZXldLnJ1bGVzVG9KU09OKCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBcIntcXG5cIiArIHN5bWJvbEpTT04uam9pbihcIixcXG5cIikgKyBcIlxcbn1cIjtcbiAgICB9O1xuXG4gICAgLy8gQ3JlYXRlIG9yIHB1c2ggcnVsZXNcbiAgICBHcmFtbWFyLnByb3RvdHlwZS5wdXNoUnVsZXMgPSBmdW5jdGlvbihrZXksIHJhd1J1bGVzLCBzb3VyY2VBY3Rpb24pIHtcblxuICAgICAgICBpZiAodGhpcy5zeW1ib2xzW2tleV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zeW1ib2xzW2tleV0gPSBuZXcgU3ltYm9sKHRoaXMsIGtleSwgcmF3UnVsZXMpO1xuICAgICAgICAgICAgaWYgKHNvdXJjZUFjdGlvbilcbiAgICAgICAgICAgICAgICB0aGlzLnN5bWJvbHNba2V5XS5pc0R5bmFtaWMgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zeW1ib2xzW2tleV0ucHVzaFJ1bGVzKHJhd1J1bGVzKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBHcmFtbWFyLnByb3RvdHlwZS5wb3BSdWxlcyA9IGZ1bmN0aW9uKGtleSkge1xuICAgICAgICBpZiAoIXRoaXMuc3ltYm9sc1trZXldKVxuICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChcIkNhbid0IHBvcDogbm8gc3ltYm9sIGZvciBrZXkgXCIgKyBrZXkpO1xuICAgICAgICB0aGlzLnN5bWJvbHNba2V5XS5wb3BSdWxlcygpO1xuICAgIH07XG5cbiAgICBHcmFtbWFyLnByb3RvdHlwZS5zZWxlY3RSdWxlID0gZnVuY3Rpb24oa2V5LCBub2RlLCBlcnJvcnMpIHtcbiAgICAgICAgaWYgKHRoaXMuc3ltYm9sc1trZXldKSB7XG4gICAgICAgICAgICB2YXIgcnVsZSA9IHRoaXMuc3ltYm9sc1trZXldLnNlbGVjdFJ1bGUobm9kZSwgZXJyb3JzKTtcblxuICAgICAgICAgICAgcmV0dXJuIHJ1bGU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGYWlsb3ZlciB0byBhbHRlcm5hdGl2ZSBzdWJncmFtbWFyc1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3ViZ3JhbW1hcnMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc3ViZ3JhbW1hcnNbaV0uc3ltYm9sc1trZXldKVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN1YmdyYW1tYXJzW2ldLnN5bWJvbHNba2V5XS5zZWxlY3RSdWxlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBObyBzeW1ib2w/XG4gICAgICAgIGVycm9ycy5wdXNoKFwiTm8gc3ltYm9sIGZvciAnXCIgKyBrZXkgKyBcIidcIik7XG4gICAgICAgIHJldHVybiBcIigoXCIgKyBrZXkgKyBcIikpXCI7XG4gICAgfTtcblxuICAgIC8vIFBhcnNlcyBhIHBsYWludGV4dCBydWxlIGluIHRoZSB0cmFjZXJ5IHN5bnRheFxuICAgIHRyYWNlcnkgPSB7XG5cbiAgICAgICAgY3JlYXRlR3JhbW1hciA6IGZ1bmN0aW9uKHJhdykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBHcmFtbWFyKHJhdyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gUGFyc2UgdGhlIGNvbnRlbnRzIG9mIGEgdGFnXG4gICAgICAgIHBhcnNlVGFnIDogZnVuY3Rpb24odGFnQ29udGVudHMpIHtcblxuICAgICAgICAgICAgdmFyIHBhcnNlZCA9IHtcbiAgICAgICAgICAgICAgICBzeW1ib2wgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgcHJlYWN0aW9ucyA6IFtdLFxuICAgICAgICAgICAgICAgIHBvc3RhY3Rpb25zIDogW10sXG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzIDogW11cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgc2VjdGlvbnMgPSB0cmFjZXJ5LnBhcnNlKHRhZ0NvbnRlbnRzKTtcbiAgICAgICAgICAgIHZhciBzeW1ib2xTZWN0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uc1tpXS50eXBlID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzeW1ib2xTZWN0aW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbFNlY3Rpb24gPSBzZWN0aW9uc1tpXS5yYXc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAoXCJtdWx0aXBsZSBtYWluIHNlY3Rpb25zIGluIFwiICsgdGFnQ29udGVudHMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VkLnByZWFjdGlvbnMucHVzaChzZWN0aW9uc1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc3ltYm9sU2VjdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgLy8gICB0aHJvdyAoXCJubyBtYWluIHNlY3Rpb24gaW4gXCIgKyB0YWdDb250ZW50cyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBjb21wb25lbnRzID0gc3ltYm9sU2VjdGlvbi5zcGxpdChcIi5cIik7XG4gICAgICAgICAgICAgICAgcGFyc2VkLnN5bWJvbCA9IGNvbXBvbmVudHNbMF07XG4gICAgICAgICAgICAgICAgcGFyc2VkLm1vZGlmaWVycyA9IGNvbXBvbmVudHMuc2xpY2UoMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VkO1xuICAgICAgICB9LFxuXG4gICAgICAgIHBhcnNlIDogZnVuY3Rpb24ocnVsZSkge1xuICAgICAgICAgICAgdmFyIGRlcHRoID0gMDtcbiAgICAgICAgICAgIHZhciBpblRhZyA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIHNlY3Rpb25zID0gW107XG4gICAgICAgICAgICB2YXIgZXNjYXBlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICB2YXIgZXJyb3JzID0gW107XG4gICAgICAgICAgICB2YXIgc3RhcnQgPSAwO1xuXG4gICAgICAgICAgICB2YXIgZXNjYXBlZFN1YnN0cmluZyA9IFwiXCI7XG4gICAgICAgICAgICB2YXIgbGFzdEVzY2FwZWRDaGFyID0gdW5kZWZpbmVkO1xuXG4gICAgICAgICAgICBpZiAocnVsZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWN0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgIHNlY3Rpb25zLmVycm9ycyA9IGVycm9ycztcblxuICAgICAgICAgICAgICAgIHJldHVybiBzZWN0aW9ucztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlU2VjdGlvbihzdGFydCwgZW5kLCB0eXBlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVuZCAtIHN0YXJ0IDwgMSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKHN0YXJ0ICsgXCI6IGVtcHR5IHRhZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IDIpXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChzdGFydCArIFwiOiBlbXB0eSBhY3Rpb25cIik7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHJhd1N1YnN0cmluZztcbiAgICAgICAgICAgICAgICBpZiAobGFzdEVzY2FwZWRDaGFyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmF3U3Vic3RyaW5nID0gZXNjYXBlZFN1YnN0cmluZyArIFwiXFxcXFwiICsgcnVsZS5zdWJzdHJpbmcobGFzdEVzY2FwZWRDaGFyICsgMSwgZW5kKTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJhd1N1YnN0cmluZyA9IHJ1bGUuc3Vic3RyaW5nKHN0YXJ0LCBlbmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZWN0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA6IHR5cGUsXG4gICAgICAgICAgICAgICAgICAgIHJhdyA6IHJhd1N1YnN0cmluZ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGxhc3RFc2NhcGVkQ2hhciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBlc2NhcGVkU3Vic3RyaW5nID0gXCJcIjtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcnVsZS5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgaWYgKCFlc2NhcGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjID0gcnVsZS5jaGFyQXQoaSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoKGMpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBFbnRlciBhIGRlZXBlciBicmFja2V0ZWQgc2VjdGlvblxuICAgICAgICAgICAgICAgICAgICBjYXNlICdbJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXB0aCA9PT0gMCAmJiAhaW5UYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnQgPCBpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVTZWN0aW9uKHN0YXJ0LCBpLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGkgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGVwdGgrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ10nOlxuICAgICAgICAgICAgICAgICAgICAgICAgZGVwdGgtLTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRW5kIGEgYnJhY2tldGVkIHNlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXB0aCA9PT0gMCAmJiAhaW5UYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVTZWN0aW9uKHN0YXJ0LCBpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGkgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gSGFzaHRhZ1xuICAgICAgICAgICAgICAgICAgICAvLyAgIGlnbm9yZSBpZiBub3QgYXQgZGVwdGggMCwgdGhhdCBtZWFucyB3ZSBhcmUgaW4gYSBicmFja2V0XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJyMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlcHRoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluVGFnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVNlY3Rpb24oc3RhcnQsIGksIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGkgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFydCA8IGkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVTZWN0aW9uKHN0YXJ0LCBpLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBpICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5UYWcgPSAhaW5UYWc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlICdcXFxcJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVzY2FwZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXNjYXBlZFN1YnN0cmluZyA9IGVzY2FwZWRTdWJzdHJpbmcgKyBydWxlLnN1YnN0cmluZyhzdGFydCwgaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGkgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdEVzY2FwZWRDaGFyID0gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZXNjYXBlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdGFydCA8IHJ1bGUubGVuZ3RoKVxuICAgICAgICAgICAgICAgIGNyZWF0ZVNlY3Rpb24oc3RhcnQsIHJ1bGUubGVuZ3RoLCAwKTtcblxuICAgICAgICAgICAgaWYgKGluVGFnKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goXCJVbmNsb3NlZCB0YWdcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGVwdGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goXCJUb28gbWFueSBbXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRlcHRoIDwgMCkge1xuICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKFwiVG9vIG1hbnkgXVwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU3RyaXAgb3V0IGVtcHR5IHBsYWludGV4dCBzZWN0aW9uc1xuXG4gICAgICAgICAgICBzZWN0aW9ucyA9IHNlY3Rpb25zLmZpbHRlcihmdW5jdGlvbihzZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlY3Rpb24udHlwZSA9PT0gMCAmJiBzZWN0aW9uLnJhdy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2VjdGlvbnMuZXJyb3JzID0gZXJyb3JzO1xuICAgICAgICAgICAgcmV0dXJuIHNlY3Rpb25zO1xuICAgICAgICB9LFxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBpc1Zvd2VsKGMpIHtcbiAgICAgICAgdmFyIGMyID0gYy50b0xvd2VyQ2FzZSgpO1xuICAgICAgICByZXR1cm4gKGMyID09PSAnYScpIHx8IChjMiA9PT0gJ2UnKSB8fCAoYzIgPT09ICdpJykgfHwgKGMyID09PSAnbycpIHx8IChjMiA9PT0gJ3UnKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaXNBbHBoYU51bShjKSB7XG4gICAgICAgIHJldHVybiAoYyA+PSAnYScgJiYgYyA8PSAneicpIHx8IChjID49ICdBJyAmJiBjIDw9ICdaJykgfHwgKGMgPj0gJzAnICYmIGMgPD0gJzknKTtcbiAgICB9O1xuICAgIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHtcbiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oWy4qKz9ePSE6JHt9KCl8XFxbXFxdXFwvXFxcXF0pL2csIFwiXFxcXCQxXCIpO1xuICAgIH1cblxuICAgIHZhciBiYXNlRW5nTW9kaWZpZXJzID0ge1xuXG4gICAgICAgIHJlcGxhY2UgOiBmdW5jdGlvbihzLCBwYXJhbXMpIHtcbiAgICAgICAgICAgIC8vaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMTQ0NzgzL3JlcGxhY2luZy1hbGwtb2NjdXJyZW5jZXMtb2YtYS1zdHJpbmctaW4tamF2YXNjcmlwdFxuICAgICAgICAgICAgcmV0dXJuIHMucmVwbGFjZShuZXcgUmVnRXhwKGVzY2FwZVJlZ0V4cChwYXJhbXNbMF0pLCAnZycpLCBwYXJhbXNbMV0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNhcGl0YWxpemVBbGwgOiBmdW5jdGlvbihzKSB7XG4gICAgICAgICAgICB2YXIgczIgPSBcIlwiO1xuICAgICAgICAgICAgdmFyIGNhcE5leHQgPSB0cnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWlzQWxwaGFOdW0ocy5jaGFyQXQoaSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhcE5leHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBzMiArPSBzLmNoYXJBdChpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNhcE5leHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHMyICs9IHMuY2hhckF0KGkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgczIgKz0gcy5jaGFyQXQoaSkudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhcE5leHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHMyO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNhcGl0YWxpemUgOiBmdW5jdGlvbihzKSB7XG4gICAgICAgICAgICByZXR1cm4gcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHMuc3Vic3RyaW5nKDEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGEgOiBmdW5jdGlvbihzKSB7XG4gICAgICAgICAgICBpZiAocy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHMuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgPT09ICd1Jykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocy5jaGFyQXQoMikudG9Mb3dlckNhc2UoKSA9PT0gJ2knKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImEgXCIgKyBzO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGlzVm93ZWwocy5jaGFyQXQoMCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImFuIFwiICsgcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBcImEgXCIgKyBzO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgZmlyc3RTIDogZnVuY3Rpb24ocykge1xuICAgICAgICAgICAgY29uc29sZS5sb2cocyk7XG4gICAgICAgICAgICB2YXIgczIgPSBzLnNwbGl0KFwiIFwiKTtcblxuICAgICAgICAgICAgdmFyIGZpbmlzaGVkID0gYmFzZUVuZ01vZGlmaWVycy5zKHMyWzBdKSArIFwiIFwiICsgczIuc2xpY2UoMSkuam9pbihcIiBcIik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhmaW5pc2hlZCk7XG4gICAgICAgICAgICByZXR1cm4gZmluaXNoZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcyA6IGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAocy5jaGFyQXQocy5sZW5ndGggLTEpKSB7XG4gICAgICAgICAgICBjYXNlICdzJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gcyArIFwiZXNcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2gnOlxuICAgICAgICAgICAgICAgIHJldHVybiBzICsgXCJlc1wiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAneCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBcImVzXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd5JzpcbiAgICAgICAgICAgICAgICBpZiAoIWlzVm93ZWwocy5jaGFyQXQocy5sZW5ndGggLSAyKSkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzLnN1YnN0cmluZygwLCBzLmxlbmd0aCAtIDEpICsgXCJpZXNcIjtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzICsgXCJzXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBzICsgXCJzXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVkIDogZnVuY3Rpb24ocykge1xuICAgICAgICAgICAgc3dpdGNoIChzLmNoYXJBdChzLmxlbmd0aCAtMSkpIHtcbiAgICAgICAgICAgIGNhc2UgJ3MnOlxuICAgICAgICAgICAgICAgIHJldHVybiBzICsgXCJlZFwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBcImRcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2gnOlxuICAgICAgICAgICAgICAgIHJldHVybiBzICsgXCJlZFwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAneCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBcImVkXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd5JzpcbiAgICAgICAgICAgICAgICBpZiAoIWlzVm93ZWwocy5jaGFyQXQocy5sZW5ndGggLSAyKSkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzLnN1YnN0cmluZygwLCBzLmxlbmd0aCAtIDEpICsgXCJpZWRcIjtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzICsgXCJkXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBzICsgXCJlZFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIHRyYWNlcnkuYmFzZUVuZ01vZGlmaWVycyA9IGJhc2VFbmdNb2RpZmllcnM7IFxuICAgIC8vIEV4dGVybmFsaXplXG4gICAgdHJhY2VyeS5UcmFjZXJ5Tm9kZSA9IFRyYWNlcnlOb2RlO1xuXG4gICAgdHJhY2VyeS5HcmFtbWFyID0gR3JhbW1hcjtcbiAgICB0cmFjZXJ5LlN5bWJvbCA9IFN5bWJvbDtcbiAgICB0cmFjZXJ5LlJ1bGVTZXQgPSBSdWxlU2V0O1xuICAgIHJldHVybiB0cmFjZXJ5O1xufSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHRyYWNlcnk7ICIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGxldCB0cmFjZXJ5ID0gcmVxdWlyZSgndHJhY2VyeS1ncmFtbWFyJyk7XHJcbiAgICBsZXQgZ3JhbW1hciA9IHRyYWNlcnkuY3JlYXRlR3JhbW1hcihKU09OLnBhcnNlKEdNX2dldFJlc291cmNlVGV4dChcImNKU09OXCIpKSk7XHJcbiAgICBncmFtbWFyLmFkZE1vZGlmaWVycyh0cmFjZXJ5LmJhc2VFbmdNb2RpZmllcnMpO1xyXG4gICAgY29uc3QgRFJPUERPV05fSFRNTCA9IGBcclxuICAgIDxwIGNsYXNzPVwiZm9vdG5vdGVcIiBzdHlsZT1cIm1hcmdpbi1ib3R0b206IC0xNXB4O1wiPlxyXG4gICAgICAgIDxzZWxlY3QgbmFtZT1cIm5pY2UtY29tbWVudFwiIGlkPVwibmljZS1jb21tZW50LWRyb3Bkb3duXCI+XHJcbiAgICAgICAgICAgIDxvcHRpb24gc2VsZWN0ZWQ9XCJzZWxlY3RlZFwiIHZhbHVlPVwiY2xlYXJcIj48L29wdGlvbj5cclxuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInJlX3JlYWRcIj5SZS1yZWFkPC9vcHRpb24+XHJcbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJsb3ZlXCI+TG92ZTwvb3B0aW9uPlxyXG4gICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYW5nc3RcIj5Dcnlpbmc8L29wdGlvbj5cclxuICAgICAgICA8L3NlbGVjdD5cclxuICAgIDwvcD5cclxuICAgIGA7XHJcbiAgICBsZXQgZHJvcGRvd25XcmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgZHJvcGRvd25XcmFwLmlubmVySFRNTCA9IERST1BET1dOX0hUTUw7XHJcbiAgICBkcm9wZG93bldyYXAgPSBkcm9wZG93bldyYXAuZmlyc3RFbGVtZW50Q2hpbGQ7XHJcbiAgICBsZXQgZHJvcGRvd24gPSBkcm9wZG93bldyYXAuZmlyc3RFbGVtZW50Q2hpbGQ7XHJcbiAgICBjb25zdCBDT01NRU5UX0lOUFVUID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcInRleHRhcmVhW2lkKj0nY29tbWVudF9jb250ZW50X2ZvciddXCIpO1xyXG4gICAgZHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4gQ09NTUVOVF9JTlBVVC52YWx1ZSA9IGdyYW1tYXIuZmxhdHRlbihgIyR7ZHJvcGRvd24udmFsdWV9I2ApKTtcclxuICAgIGxldCBjb21tZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImZvcm0ubmV3X2NvbW1lbnQgZmllbGRzZXRcIik7XHJcbiAgICBjb21tZW50Lmluc2VydEJlZm9yZShkcm9wZG93bldyYXAsIGNvbW1lbnQuY2hpbGRyZW5bM10pO1xyXG59KSgpO1xyXG4iXSwibmFtZXMiOlsidHJhY2VyeSIsIlRyYWNlcnlOb2RlIiwicGFyZW50IiwiY2hpbGRJbmRleCIsInNldHRpbmdzIiwidGhpcyIsImVycm9ycyIsInVuZGVmaW5lZCIsInJhdyIsInB1c2giLCJHcmFtbWFyIiwiZ3JhbW1hciIsImRlcHRoIiwidHlwZSIsImlzRXhwYW5kZWQiLCJOb2RlQWN0aW9uIiwibm9kZSIsInNlY3Rpb25zIiwic3BsaXQiLCJ0YXJnZXQiLCJsZW5ndGgiLCJydWxlIiwiUnVsZVNldCIsImZhbGxvZmYiLCJBcnJheSIsImlzQXJyYXkiLCJkZWZhdWx0UnVsZXMiLCJTdHJpbmciLCJwcm90b3R5cGUiLCJ0b1N0cmluZyIsImV4cGFuZENoaWxkcmVuIiwiY2hpbGRSdWxlIiwicHJldmVudFJlY3Vyc2lvbiIsImNoaWxkcmVuIiwiZmluaXNoZWRUZXh0IiwicGFyc2UiLCJjb25jYXQiLCJpIiwiZXhwYW5kIiwiZXhwYW5zaW9uRXJyb3JzIiwicHJlYWN0aW9ucyIsInBvc3RhY3Rpb25zIiwicGFyc2VkIiwicGFyc2VUYWciLCJzeW1ib2wiLCJtb2RpZmllcnMiLCJjcmVhdGVVbmRvIiwiYWN0aXZhdGUiLCJzZWxlY3RlZFJ1bGUiLCJzZWxlY3RSdWxlIiwibW9kTmFtZSIsIm1vZFBhcmFtcyIsImluZGV4T2YiLCJyZXN1bHRzIiwiZXhlYyIsInN1YnN0cmluZyIsIm1vZCIsImFjdGlvbiIsImNsZWFyRXNjYXBlQ2hhcnMiLCJyZXBsYWNlIiwicnVsZVNlY3Rpb25zIiwiZmluaXNoZWRSdWxlcyIsInJ1bGVOb2RlcyIsIm4iLCJwdXNoUnVsZXMiLCJwb3BSdWxlcyIsImZsYXR0ZW4iLCJ0b1RleHQiLCJjb25kaXRpb25hbFJ1bGUiLCJ2YWx1ZSIsImNvbmRpdGlvbmFsVmFsdWVzIiwidiIsInJhbmtpbmciLCJpbmRleCIsImRpc3RyaWJ1dGlvbiIsInNodWZmbGVkRGVjayIsImFycmF5IiwidGVtcG9yYXJ5VmFsdWUiLCJyYW5kb21JbmRleCIsImN1cnJlbnRJbmRleCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImZ5c2h1ZmZsZSIsImFwcGx5IiwibWFwIiwiTnVtYmVyIiwiY2FsbCIsInBvcCIsInBvdyIsImRlZmF1bHRVc2VzIiwiY2xlYXJTdGF0ZSIsIlN5bWJvbCIsImtleSIsInJhd1J1bGVzIiwiYmFzZVJ1bGVzIiwic3RhY2siLCJ1c2VzIiwicnVsZXMiLCJnZXRBY3RpdmVSdWxlcyIsInJ1bGVzVG9KU09OIiwiSlNPTiIsInN0cmluZ2lmeSIsImxvYWRGcm9tUmF3T2JqIiwiaXNWb3dlbCIsImMiLCJjMiIsInRvTG93ZXJDYXNlIiwia2V5cyIsIk9iamVjdCIsInN5bWJvbHMiLCJhZGRNb2RpZmllcnMiLCJtb2RzIiwiaGFzT3duUHJvcGVydHkiLCJzdWJncmFtbWFycyIsImNyZWF0ZVJvb3QiLCJhbGxvd0VzY2FwZUNoYXJzIiwicm9vdCIsInRvSlNPTiIsInN5bWJvbEpTT04iLCJqb2luIiwic291cmNlQWN0aW9uIiwiaXNEeW5hbWljIiwiYmFzZUVuZ01vZGlmaWVycyIsInMiLCJwYXJhbXMiLCJSZWdFeHAiLCJjYXBpdGFsaXplQWxsIiwiczIiLCJjYXBOZXh0IiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJjYXBpdGFsaXplIiwiYSIsImZpcnN0UyIsImNvbnNvbGUiLCJsb2ciLCJmaW5pc2hlZCIsInNsaWNlIiwiZWQiLCJjcmVhdGVHcmFtbWFyIiwidGFnQ29udGVudHMiLCJzeW1ib2xTZWN0aW9uIiwiY29tcG9uZW50cyIsImluVGFnIiwiZXNjYXBlZCIsInN0YXJ0IiwiZXNjYXBlZFN1YnN0cmluZyIsImxhc3RFc2NhcGVkQ2hhciIsImNyZWF0ZVNlY3Rpb24iLCJlbmQiLCJyYXdTdWJzdHJpbmciLCJmaWx0ZXIiLCJzZWN0aW9uIiwibW9kdWxlIiwiZXhwb3J0cyIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJHTV9nZXRSZXNvdXJjZVRleHQiLCJkcm9wZG93bldyYXAiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJmaXJzdEVsZW1lbnRDaGlsZCIsImRyb3Bkb3duIiwiQ09NTUVOVF9JTlBVVCIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwiY29tbWVudCIsImluc2VydEJlZm9yZSJdLCJzb3VyY2VSb290IjoiIn0=